
      1. РАБОТА ПОД МУЛЬТИЗАДАЧНЫМИ ОПЕРАЦИОННЫМИ СИСТЕМАМИ


     Sf-Mail (далее SFM) имеет встроенные средства взаимодействия
практически     со     всеми      известными     мультизадачными/
мультипользовательскими   операционными   системами.    Это   как
широкоизвестные системы,  так  и  известные  ограниченному  числу
специалистов.   Благодаря  этому   SFM   корректно   работает   в
многозадачной среде, оптимально используя ресурсы ОС(операционная
система).  Однако,  некоторые  ОС  благодаря  своему  внутреннему
устройству,   не  могут  обеспечить  преемлемое  качество  работы
программ без их тонкой настройки (практически все продукты  фирмы
MicroSoft). Далее мы дадим конкретные рекомендации по оптимальной
настройки SFM для работы под некоторыми ОС.


                    1.1 MicroSoft Windows 3.1

     Для хорошей работы SFM как  и  любого  другого  мэйлера  под
данной  ОС  с  высокоскоростным  модемом   мы   рекомендуем   Вам
использовать  модем(если  внутренний  иначе  плата  COM-порта)  с
микросхемой имеющей FIFO.  Также мы рекомендуем Вам  использовать
Fossil драйвер имеющий поддержку FIFO.

     A) Фоссил необходимо загружать до запуска Windows

     B) Модем должен иметь FIFO

     C) Мы рекомендуем установить степень заполнения FIFO  равную
8, а скорость "залочить. Например для популярного фоссила X00:

     X00 B,1,38400,8N1 FIFO=8

     Что означает "залочит" COM2 на  скорость  38400  ,установить
уровень срабатывания FIFO равное 8.

     D) Мы нерекомендуем лочить  порт  на  скорость  большую  чем
38400.

     Далее Вам  нужно  изменить/добавить  некоторые  параметры  в
файле system.ini ОС Windows.

     В секции [386Enh] добавьте/измените следующие параметры:

     MinTimeSlice=10
     COMxFIFO=1
     COMBoostTime=1

     "x" во второй строке замените на номер порта где у Вас стоит
модем: 1 для COM1 2 для COM2 и т.д. Если у Вас нет FIFO то вторая
строка должна выглядеть так:

     COMxFIFO=0

     Так-же,  мы рекомендуем Вам использовать файл sf-mail.pif из
поставки  SFM  для  запуска  SFM.   Для  этого  вы   должны   его
подредактировать в PifEditore программы Windows - Вам  необходимо
проставить правильный путь до sf-mail.exe.

     И последнее. Мы настоятельно не рекомендуем Вам использовать
видеодрайвера из стандартной поставки Windows 3.1.
  

                          1.2 DesqView

     Для успешной работы  под  DesqView(DV)  Вам  необходимо  при
инсталляции    DV     ответить     утвердительно     в     пункте
OptimizeCommunications.
     Также мы рекомендуем Вам модем с  FIFO  и  все  рекомендации
касающиеся фоссила перечисленные в п.1.1.
     Для запуска SFM  под  DV  мы  рекомендуем  Вам  использовать
sf-mail.dvp входящий в поставку SFM.


                 1.3 IBM OS/2 ver 2.xx, ver 3.xx


     Здесь впишеш Сам



   1.4 TSX-32 Lite, Multitasker-Multiuser OS by S&H Technology

     Для успешной работы SFM под данной операционной системой  мы
советуем вам запускать мэйлер с  помощью  комбинации  BAT  и  CMD
файлов.  BAT файл  Вам  понадобится  потому,  что  TSX  не  умеет
корректно пускать резиденты,  коим является  фоссил,  без  запуска
Досовского командного процессора.  Что-бы справится  с  этим  Вам
нужно создать следующий BAT файл:

     -----------
     @echo off

     rem запускаем фоссил с залочкой на 57600 фифо на половину
     BNU /R:4096 /T:512 /P:1 /L:1=57600,8N1 /Z2
     rem запускаем мэйлер
     sf-mail.exe
     -----------

     Далее мы рекомендуем Вам создать CMD файл из которого  будет
запускаться выше описанный BAT файл:
-------------------------------------------
CurrentDir = $CWD()
CurrentId = $Jobinfo( "JOBID" )
OldName = $Jobinfo( "PNAME" )
set process/identification='CurrentId'/name="SantaFoxMailer"
set process/maxttchk=500/nobell/nottfwbell
set working_set/noadjust
Start:
run/nodwrite/holdpriority/ttwait/ttckio/iopriv COMMAND.COM sf-mail.bat
cd 'CurrentDir'
set process/identification='CurrentId'/name="''OldName"
---------------------------------------------

     Данные файлы входят в поставку SF-MAIL.

     Также мы рекомендуем выключить эммуляцию FIFO или установить
уровень его срабатывания на  1.  Для  этого  Вам  надо  запустить
системную программу TSGEN и в  конце  списка  Tuning  parammeters
найти секцию отвечающую за Virtual UART.
     Под данной операционной системой мы советуем  Вам  поставить
Time_Quant=0 (Default) и Sleep_Method=Default  однако  вы  можете
по эксперементировать со Sleep_Method  HLT.

   1.5 Установка параметров Time_Quant и Sleep_Method в файле
                           Sf-Mail.cfg

     Параметры  Time_Quant  и  Sleep_Method   тесно   связаны   с
взаимодействием SFM с многозадачной средой.

     Параметр   TQ(Time_Quant)   задает   время   которое   будет
отдаваться ОС мэйлером.  То-есть,  когда мэйлер находится в цикле
ожидания какого либо события  (прерывания  клавиатуры,  байта  из
модема и т.д.) он вызывает внутреннюю функцию  отдачи  свободного
времени.  Переменная TQ как раз и определяет время через  которое
мэйлер опять получит управление (на это время процессор переходит
в пользование другой задаче).
     Все выше сказанное справедливо при Sleep_Method (Метод  сна)
задающем отдачу фиксированного времени.

     Мы рекомендуем Вам присваивать  TQ  значение  ноль,  в  этом
случае SFM присвоит TQ  значение  по  умолчанию  оптимальное  для
каждой операционной системы.
     Если же вы хотите сами менять  эту  переменную  то  прочтите
следующее.

     Число  присваемое  TQ  есть  время  в  миллисекундах  для
следующих ОС:

     ОС	                                    Значение по умолчанию
     ────────────────────────────────────────────────────────────
     OS/2                                           55 mS
     PC-MOS/386                                     55 mS
     European MS-DOS 4.0                            55 mS
     DoubleDos                                      55 mS
     RTS-386                                        55 mS

     Некоторые ОС не позволяют конкретно задать время, для них TQ
есть некая абстрактная величина от 0 до 65535, чем больше она тем
меньше времени отнимает у ОС мэйлер.

     ОС	                                    Значение по умолчанию
     ────────────────────────────────────────────────────────────
     Desq                                           255
     Windows 3.11                                   255
     MS-DOS 5 or above                              255


     Мы Вам советуем использовать установку Time_Quant=0.
     Что касается переменной  Sleep_Method,  то  устанавливая  ее
соответствующим образом вы принудительно выбираете тот  или  иной
метод отдачи процессорного времени.
     Приведем лишь рекомендации:

     Для  Windows  3.1  в  случае  сильного  "засыпания"  мэйлера
советуем поставить HLT или INT28.
     Для RTS-386 мы настоятельно рекомендуем HLT.
     Для OS/2 вы можете использовать HLT , INT28 или INT2F

     Мы   настоятельно    рекомендуем    установить    переменную
Sleep_Method в Default (кроме RTS-386).

     Допустимые значения переменной Sleep_Method:

     HLT
     INT28
     INT2F

     Остальные значения не могут быть установлены и игнорируются.
При установленной в  Default  переменной  Sleep_Method,  SFM  сам
определяет способ отдачи времени в зависимости от ОС под  которой
он запущен. SFM идентифицирует следующие ОС:

      OS/2
      DesqView
      PC-MOS/386
      Windows or other supported 1680h int2fh
      MS-DOS 5 or above
      Eropean MS-DOS 4.0
      DoubleDos
      RTS-386


     С.- Петербург, Россия, 20.12.94 Вадим Барановский :-)
     Москва, Кремль,................Ну сами знаете кто соавтор

