
      1. РАБОТА ПОД МУЛЬТИЗАДАЧНЫМИ ОПЕРАЦИОННЫМИ СИСТЕМАМИ


     Sf-Mail (далее SFM) имеет встроенные средства взаимодействия
практически     со     всеми      известными     мультизадачными/
мультипользовательскими   операционными   системами.    Это   как
широкоизвестные системы,  так  и  известные  ограниченному  числу
специалистов.   Благодаря  этому   SFM   корректно   работает   в
многозадачной среде, оптимально используя ресурсы ОС(операционная
система).  Однако,  некоторые  ОС  благодаря  своему  внутреннему
устройству,   не  могут  обеспечить  преемлемое  качество  работы
программ без их тонкой настройки (практически все продукты  фирмы
MicroSoft). Далее мы дадим конкретные рекомендации по оптимальной
настройки SFM для работы под некоторыми ОС.


                    1.1 MicroSoft Windows 3.1

     Для хорошей работы SFM как  и  любого  другого  мэйлера  под
данной  ОС  с  высокоскоростным  модемом   мы   рекомендуем   Вам
использовать  модем(если  внутренний  иначе  плата  COM-порта)  с
микросхемой имеющей FIFO.  Также мы рекомендуем Вам  использовать
Fossil драйвер имеющий поддержку FIFO.

     A) Фоссил необходимо загружать до запуска Windows

     B) Модем должен иметь FIFO

     C) Мы рекомендуем установить степень заполнения FIFO  равную
8, а скорость "залочить". Например для популярного фоссила X00:

     X00 E F=8 R=4096 T=2048
     XU LOCK:1:38400:8N1

     Что означает "залочит" COM2 на  скорость  38400  ,установить
уровень срабатывания FIFO равное 8.

     D) Мы нерекомендуем лочить  порт  на  скорость  большую  чем
38400.

     Далее Вам  нужно  изменить/добавить  некоторые  параметры  в
файле system.ini ОС Windows.

     В секции [386Enh] добавить/измените следующие параметры:

     MinTimeSlice=10
     COMxFIFO=1
     COMBoostTime=1

     "x" во второй строке замените на номер порта где у Вас стоит
модем: 1 для COM1 2 для COM2 и т.д. Если у Вас нет FIFO то вторая
строка должна выглядеть так:

     COMxFIFO=0

     Если у Вас модем установлен на использование не стандартного
для COM портов прерывание  то  Вам  необходимо  вставить  в  файл
system.ini еще и следующую строку:
     COMxIRQ = X
     где :
     x - номер вашего порта
     X - номер прерывания.  (стандартно для COM1,COM3  =  4,  для
COM2,COM4 = 3
     Так-же,  мы рекомендуем Вам использовать файл sf-mail.pif из
поставки  SFM  для  запуска  SFM.   Для  этого  вы   должны   его
подредактировать в PifEditore программы Windows - Вам  необходимо
проставить правильный путь до sf-mail.exe.

     И последнее.  Мы настоятельно рекомендуем  Вам  использовать
видеодрайвера не  из  стандартной  поставки  Windows  3.1,  а  те
которые идут с Вашей видеокартой на дискете.


                          1.2 DesqView 386/286

     Для успешной работы  под  DesqView(DV)  Вам  необходимо  при
инсталляции    DV     ответить     утвердительно     в     пункте
OptimizeCommunications.
     Также мы рекомендуем Вам модем с  FIFO  и  все  рекомендации
касающиеся фоссила перечисленные в п.1.1.
     Для запуска SFM  под  DV  мы  рекомендуем  Вам  использовать
sf-mail.dvp входящий в поставку SFM.
     Для  инсталляции  sf-mail  в  список  программ   DESQ,   Вам
необходимо сначало проинсталировать  sf-mail  как  обычно.  Затем
запустить DESQ затем:
     Выбрать в меню DESQ пункт "Open Window" и войти в него
     Выбрать пункт меню "Add a Program" и войти в него
     Нажать клавишу "O" (Other Program)
     После этого появится приглашение набрать путь к программе
     Наберите полный путь к директории где находится sf-mail.dvp,
но не заканчивайте этот путь символом "\".
     После этого в меню появится надпись "Santa Fox  Mail"  (если
их появится две - что может быть если в этой же директории  лежит
pif-файл для Windows 3.1,  то выберете левый)  ,  опустите  линию
подсветки на эту строку и нажмите пробел.
     Переместите линию подсветки на пункт меню "DONE"  и  нажмите
Enter.
     Теперь в меню DESQ,  в списке програм вы увидите  Santa  Fox
Mail.
     Теперь выберете пункт меню "Change a Program"  и  войдите  в
него.
     Там Вам необходимо прописать правильное имя  директории  где
находится собственно файл SF-MAIL.EXE.  Опять же имя должно  быть
полным - с диском, и НЕ заканчиватся символом "\".
     Если необходимо то  там  же  в  установках  поменяйте  номер
коммуникационного  порта  на  тот  на  котором  стоит  модем  (по
умолчанию стоит "Y",  но если у Вас модем на порту  1  или  2  то
лучше поставить конкретные значения).
     Так же ВАм сследует учесть что объем обычной  и  расширенной
памяти в файле sf-mail.dvp поставлен из расчета  на  то,  что  вы
будете запускать внешние процессы из мэйлера как отдельные задачи
DESQ,  в независимых от мэйлера окнах (см.  секцию запуск внешних
процессов).  Если вы хотите запускать  внешние  процессы  обычным
досовским способом,  то Вам надлежит увеличить поле MinMEMSIze до
350 килобайт(подбирается эксперементально),  а поле  Exp  Mem  до
512k(зависит от  потребности  запускаемых  внешних  процессов,  а
также от ключей свопинга).
     Так   же   вы    можете    в    сетапе    DESQ    установить
OptimizeCommunications в Yes.  Мы рекомендуем  Вам  дополнительно
ознакомится  с  рекомендациями   по   использованию   конкретного
фоссил-драйвера с DESQ в документации на этот драйвер.
     Рекомендуем Вам установить соотношение  Back/Fore  ground  в
2/2 или 4/2 .

     Примечание:
     Если у Вас компъютер оснащеный процессор 286 и вы исполь-
зуете DesqView 286,  то Вам дополнительно необходимо  изменить
установки файла sf-mail.dvp :

     Writes text directly to screen      [N]
     Virtualize text/graphics (Y,N,T,)   [N]




                 1.3 IBM OS/2 ver 2.xx, ver 3.xx


     Особых настроек под OS/2 мэйлер не  требует.  Приведем  лишь
общие рекомендации.
     Используйте коммуникационные драйвера Рэя Гвинна(Ray  Gwinn).
Это драйвера OS/2 : физического устройства SIO.SYS,  виртуального
устройства VSIO.SYS,  а также драйвер Дос VX00.SYS  (обеспечивает
интерфейс FOSSIL).
     В  сеттингах  OS/2  для   sf-mail   (Settings)   рекомендуем
поставить переменную Session Priority примерно в  два  раза  выше
чем по умолчанию,  но можно и больше,  например  10.  Мэйлер  сам
отдаст не нужное ему процессорное  время  и  не  будет  тормозить
другие приложения.
     Переменную  ReleaseTQ_Method  в   файле   конфигурации   SFM
установить в "DEF" :

     ReleaseTQ_Method DEF


     Переменную Time_Quant в значение  0  (означает  значение  по
умолчанию - для OS/2 55 миллисекунд)

     Time_Quant  0

     При оптимальных настройках во время  сессии  счетчик  байтов
должен обновляться через 50-150 байт.  Если  счетчик  обновляется
реже и/или наблюдается падение CPS при работе мэйлера в фоне,  мы
рекомендуем Вам  уменьшить  значение  переменной  Time_Quant  (по
умолчанию 55 миллисекунд). Например:

     Time_Quant 30

     Если-же наблюдается обратный эффект такой как слишком частое
обновление счетчика байт и/или  большая  загрузка  процессора  то
увеличьте значение переменной Time_Quant. Например:

     Time_Quant 100

     Вы можете по эксперементировать с установками переменных OS/2
SessionPriority и sf-mail'а Time_Quant.


   1.4 TSX-32 Lite, Multitasker-Multiuser OS by S&H Technology

     Для успешной работы SFM под данной операционной системой  мы
советуем вам запускать мэйлер с  помощью  комбинации  BAT  и  CMD
файлов.  BAT файл  Вам  понадобится  потому,  что  TSX  не  умеет
корректно пускать резиденты,  коим является фоссил,  без  запуска
Досовского командного процессора.  Что-бы справится  с  этим  Вам
нужно создать следующий BAT файл:

     -----------
     @echo off

     rem запускаем фоссил с залочкой на 57600 фифо на половину
     BNU /R:4096 /T:512 /P:1 /L:1=57600,8N1 /Z2
     rem запускаем мэйлер
     sf-mail.exe
     -----------

     Далее мы рекомендуем Вам создать CMD файл из которого  будет
запускаться выше описанный BAT файл:
-------------------------------------------
CurrentDir = $CWD()
CurrentId = $Jobinfo( "JOBID" )
OldName = $Jobinfo( "PNAME" )
set process/identification='CurrentId'/name="SantaFoxMailer"
set process/maxttchk=500/nobell/nottfwbell
set working_set/noadjust
Start:
run/nodwrite/holdpriority/ttwait/ttckio/iopriv %COMSPEC% sf-mail.bat
cd 'CurrentDir'
set process/identification='CurrentId'/name="''OldName"
---------------------------------------------

     Данные файлы входят в поставку SF-MAIL.

     Также мы рекомендуем выключить эммуляцию FIFO или установить
уровень его срабатывания на  1.  Для  этого  Вам  надо  запустить
системную программу TSGEN и в  конце  списка  Tuning  parammeters
найти секцию отвечающую за Virtual UART.
     Под данной операционной системой мы советуем  Вам  поставить
Time_Quant=0  (Default)  и  ReleaseTQ_Method=Default  однако   вы
можете по эксперементировать со ReleaseTQ_Method HLT.



   1.5 Установка параметров Time_Quant и ReleaseTQ_Method в файле
                           Sf-Mail.cfg

     Параметры Time_Quant  и  ReleaseTQ_Method  тесно  связаны  с
взаимодействием SFM с многозадачной средой.

     Параметр   TQ(Time_Quant)   задает   время   которое   будет
отдаваться ОС мэйлером.  То-есть,  когда мэйлер находится в цикле
ожидания какого либо события  (прерывания  клавиатуры,  байта  из
модема и т.д.) он вызывает внутреннюю функцию  отдачи  свободного
времени.  Переменная TQ как раз и определяет время через  которое
мэйлер опять получит управление (на это время процессор переходит
в пользование другой задаче).
     Все выше сказанное справедливо при ReleaseTQ_Method задающем
отдачу фиксированного времени.

     Мы рекомендуем Вам присваивать  TQ  значение  ноль,  в  этом
случае SFM присвоит TQ  значение  по  умолчанию  оптимальное  для
каждой операционной системы.
     Если же вы хотите сами менять  эту  переменную  то  прочтите
следующее.

     Число  присваемое  TQ  есть  время  в  миллисекундах  для
следующих ОС:

     ОС                                     Значение по умолчанию
     ────────────────────────────────────────────────────────────
     OS/2                                           55 mS
     PC-MOS/386                                     55 mS
     European MS-DOS 4.0                            55 mS
     DoubleDos                                      55 mS
     RTS-386                                        55 mS

     Некоторые ОС не позволяют конкретно задать время, для них TQ
есть некая абстрактная величина от 0 до 65535, чем больше она тем
меньше времени отнимает у ОС мэйлер.

     ОС                                     Значение по умолчанию
     ────────────────────────────────────────────────────────────
     Desq                                           255
     Windows 3.11                                   255
     MS-DOS 5 or above                              255
     IPX Relinquish                                 255


     Мы Вам советуем использовать установку Time_Quant=0.
     Что касается переменной ReleaseTQ_Method, то устанавливая ее
соответствующим образом вы принудительно выбираете тот  или  иной
метод отдачи процессорного времени.
     Приведем лишь рекомендации:

     Для  Windows  3.1  в  случае  сильного  "засыпания"  мэйлера
советуем поставить HLT или I28.
     Для RTS-386 мы настоятельно рекомендуем HLT.
     Для OS/2 вы можете использовать HLT , I28 или I2F
     Для OS/2 мы всеже советует дефолт

     Мы   настоятельно    рекомендуем    установить    переменную
ReleaseTQ_Method в Default (кроме RTS-386).

     Допустимые значения переменной ReleaseTQ_Method:

     HLT        - отдача времени через инструкцию HLT
     I28        - через прерывание "Dos Idle" Int28h
     I2F        - через int2Fh AX=1680h (Generic)
     IPX        - отдача времени сетевому драйверу
     DEF        - по умолчанию - мэйлер сам выбирает метод

     Остальные значения не могут быть установлены и игнорируются.
При установленной в Default переменной ReleaseTQ_Method,  SFM сам
определяет способ отдачи времени в зависимости от ОС под  которой
он запущен. SFM идентифицирует следующие ОС:

      OS/2
      DesqView
      PC-MOS/386
      Windows or other supported 1680h int2fh
      MS-DOS 5 or above
      Eropean MS-DOS 4.0
      DoubleDos
      RTS-386

     Некоторые замечания по OS/2:
     Под OS/2 очень плохо работают методы HLT, I28 и I2F, поэтому
мы НАСТОЯТЕЛЬНО рекомендуем Вам  использовать  значение  DEF,  то
есть по  умолчанию.  В  этом  случае  мэйлер  будет  использовать
специальный  сервис  предоставляемый   OS/2   и   ресурсы   будут
расходоваться очень экономно.


    2.КОДЫ ВЫХОДА ВОЗВРАЩАЕМЫЕ ПРИ ЗАПУСКЕ ВНЕШНИХ ПРОЦЕССОВ

     При запуске внешних процессов возвращаются коды завершения (
известные  как  ERRORLEVEL  ).   При  успешном  запуске  процесса
возвращается ERRORLEVEL = 0 .  При запуске внешних процессов с  с
использованием   командного   процессора    практически    всегда
возвращается  ERRORLEVEL  =  0.   При  запуске   без   командного
процессора возвращается код завершения запущенной программы.
     NOTE!
     Нельзя запускать BAT файл  без  командного  процессора  это
может привести к зависанию системы.
     В случае если мэйлер не смог запустить  внешний  процесс  то
возвращаются следующие коды  (вы  их  можете  увидеть  на  экране
мэйлера как Return with errorlevel: ) :

NOSWAP = 8000h ;(-32768) некуда свопиться - не совпадает
разрешенное и существующее

NOCHNGMCB= 8001h ;(-32767) не изменит размер блока занимаемый нами
NOTMEM   = 8002h ;(-32766) нет места ни в памяти ни на диске
EMOVXMS  = 8003h ;(-32765) ошибка перемещения в XMS
EMOVEMS  = 8004h ;(-32764) в EMS
EMOVHDD  = 8005h ;(-32763) на диск
EMOVEXT  = 8006h ;(-32762) в EXTended
EFREEXMS = 8007h ;(-32761) ошибка при попытке освободить XMS
EFREEEMS = 8008h ;(-32760) EMS
EFREEHDD = 8009h ;(-32759) стереть своп файл

8102h(-32510)   file not found
8103h(-32509)   path not found
8104h(-32508)   too many open files (no handles available)
8105h(-32507)   access denied
8107h(-32506)   memory control block destroyed
8108h(-32505)   insufficient memory
810Ah(-32504)   environment invalid (usually >32K in length)
810Fh(-32503)   invalid drive


При выходе с фатальными (смотри ниже) ошибками  мы  в  мэйлер  не
возвращаемся. Своп-блок мэйлера сообщает о них в виде сообщения:

UniSwap Fatal. ErrorSig: #<буква >
;фатальные

DOUBLERR = Z  двойная ошибка (произошедшая в обработчике
ошибок при попытке снизить последствия первой ошибки)
NORSTMCB = Y  Не востановить прежний размер блока памяти
NORSTXMS = X  Не вернуть из XMS то, что туда сосвопили
NORSTEMS = W  Не вернуть из EMS то, что туда сосвопили
NORSTHDD = V  Не вернуть с диска то, что туда сосвопили
NORSTEXT = U  Не вернуть из EXTended memory то, что туда сосвопили


     С.- Петербург, Россия, 11.03.95 Вадим Барановский :-)
