








                   Santa Fox Mail system version 1.06/Release

            ┌──────────┌────────────────────────────────┐──────────┐
            │          │▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄│          │
            │          │▄▄▄▄▄▄▄▄▄▄████████████▄▄▄▄▄▄▄▄▄▄│          │
            │          │▄▄▄▄▄▄███████████████████▄▄▄▄▄▄▄│          │
            │          │▄▄▄▄███████████████████████▄▄▄▄▄│          │
            │          │▄▄▄████████████████████▀██ ██▄▄▄│          │
            │          │▄▄████████████████████▀▄▀▄█ ██▄▄│          │
            │          │▄████████████████████▀▄█████ ██▄│          │
            │          │▄█████████████████▀▀▄████████▄▀▄│          │
            │          │▄█▀▀█████████▀▀▀▄▄█████████████▀│          │
            │          │▀█ ▄▄▄▄▄▄▄▄▄▄█████▀  ▄▀████████▀│          │
            │          │▀▀█▄▀▀▀███████████████████████▀▀│          │
            │          │▀▀▀████▄▄▄▀▀▀████████████████▀▀▀│          │
            │          │▀▀▀▀█████████▄▄▄▀▀█████████▀▀▀▀▀│          │
            │          │▀▀▀▀▀▀████████████▄▄▀████▀▀▀▀▀▀▀│          │
            │          │▀▀▀▀▀▀▀▀▀▀███████████▄▀▀▀▀▀▀▀▀▀▀│          │
            │          │▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀│          │
            │          └────────────────────────────────┘          │
            │ SantaFox Team:  мы помогаем информации перемещаться! │
            └──────────────────────────────────────────────────────┘







                   Документация и программы пакета разработаны
                          и реализованы Santa Fox Team
                     в 1994-1996 гг., Ст.-Петербург, Россия.

                   (c) copyright by Santa Fox Team, 1994-1996.
                               All rights reserved.



    x. О продукте

         SF-Mail   является   в  своем  роде  уникальным  мэйлером,  имеющим
     достаточно   большие   возможности,   и  включающий  в  себя  следующие
     отличительные особенности:

        - Классический  интерфейс, немного напоминающий интерфейс FrontDoor,
          но наиболее оптимальный с эргономической  точки  зрения, по нашему
          мнению;
        - Возможность  работы как в Arcmail Attach (AMA) и Bink style, так и
          в смешанном режиме (Sf-Mail Mixed mode);
        - Распознаются  и  используются  нодлистовые временные флаги Txy, а
          так же флаги OH: и FR:;
        - Наличие   мощной   системы  определения  ресурсов  ОС, под которой
          работает  в данный момент мэйлер. Определение используется с целью
          оптимального  использования  ресурсов  и возможностей операционной
          системы;
        - Благодаря   мощному   Swap/Exec-модулю,  умеет  запускать  внешние
          приложения  по  заданным  настройкам  в файлах конфигурации, как в
          одиночном  окне  ДОС,  так  и  в фоновом режиме, если используется
          мультизадачная ОС, как например OS/2, DV, WIN95;
        - Уникальная  реализация  протокола  передачи  ZModem  с  поддержкой
          нестандартных блоков размером до 16k;
        - Оригинальный алгоритм реализации протокола Hydra;
        - Встроенный  терминал,  автоматически распознающий и поддерживающий
          системы   TTY/ANSI/AVATAR,   использует   ZModem,   имеет  систему
          автодозвона;
        - Возможность подключения внешней терминальной программы;
        - Очень  высокая  скорость обработки EMSI. Адаптивная подстройка под
          "особенности" мэйлера, с которым проходит сессия;
        - Развитая  система   обработки   файловых   запросов,   позволяющая
          устанавливать  ограничение  как  на  время,  так   и   на   объемы
          запрашиваемых файлов, полнопутевые и паролированные запросы;
        - Поддержка  внешнего  обработчика  файловых запросов (External FReq
          Processor);
        - Система распознавания и приема факсов;
        - Система распознования голосовых звонков и запуск автоответчика.


    x. О данном документе

         При создании данной документации мы решили отойти  от  общепринятых
     правил написания подобных документов,  которые имеют в качестве  основы
     подробно откомментированный конфигурационный файл.  Данное  руководство
     освещает  только  ключевые  моменты  работы  с  продуктом   Sf-Mail   и
     неочевидные для пользователя аспекты.  Все переменные  основного  файла
     конфигурации имеют необходимые комментарии,  и здесь  мы  будем  только
     ссылаться на них, указывая полное имя переменной и название секции.


    x. Системные требования

         Для нормальной работы Sf-Mail следует ознакомится  с  требованиями,
     предъявляемыми к аппаратуре и системному программному обеспечению.


    x.y. Требования к аппаратуре

         Минимальные требования к аппаратуре,  необходимой для использования
     Sf-Mail таковы:

      - IBM-совместимый  компьютер  на базе 80x86 процессора (286, 386, 486,
        Pentium);
      - Монитор любой (CGA, Hercules, EGA, MCGA, VGA, SVGA);
      - HDD (Жесткий диск);
      - RAM (Оперативная память) - 400Кб минимум, 1 Мб желательно;
      - Modem   (Модем)  -  любой  HAYES-совместимый.  Если  у  Вас  внешний
        скоростной   модем,   то   желательно  использовать  портовую  плату
        с буфером FIFO16550.

         Очень желательно иметь EMS  и/или  XMS  память,  поскольку  в  этом
     случае она будет  использоваться  мэйлером  для  свопинга  (при  старте
     внешних процессов) и содержания там оверлея.


    x.y. Требования к системному ПО

         Sf-Mail успешно и безпроблемно работает  в  следующих  операционных
     средах:

      - MS-DOS (v.3.3 - v.6.22)
      - Novell DOS (v.5.0 - v.7.0)
      - OS/2 v.2.1+
      - MS-Windows v.3.1+
      - Windows-95 / WindowsNT
      - DesqView 2.60+

         Также необходимо наличие fossil-совместимого драйвера.  О выборе  и
     подключении фоссила будет сказано немного позднее (см. X.Y.Z.).


    x. Терминология Sf-Mail

         Прежде  чем  описывать  принципы  работы  Sf-Mail,   определимся  с
     условными  обозначениями,  сокращениями  и  терминами.   Рамки  данного
     руководства   не   предусматривают    разъяснение    базовых    понятий
     FTN-технологии, а по-сему, если Вы начинающий пользователь и совершенно
     не  представляете  структуру  FTN-сетей  и  основные  принципы   работы
     программ для Fido,  то  обратитесь  к  соответствующей  литературе  или
     старшим товарищам за разъяснениями.

         Итак,  начнем с соглашения об адресах.  Как Вам наверняка известно,
     большинство программ используют т.н. 3D, 4D и 5D адресацию. Остановимся
     на 4D адресации, как базовой для Sf-Mail. В 4D-нотации адрес состоит из
     четырех элементов:  зона,  сеть,  узел и поинт.  В общем виде это можно
     записать так:

       zone:net/node.point

     где  zone  --  зона,  net -- сеть, node -- узел и point -- поинт.
         Например,  полная  запись  адреса  может  выглядеть так: 2:5030/143
     или так: 2:5030/143.2

         При работе с адресами  Sf-Mail  накладывает  ограничения  на  части
     адреса:

         zone   - не более 4095
         net    - не более 32767
         node   - не более 32767
         point  - не более 4095

         Наряду  с  полной  записью,   при  работе   с   Sf-Mail   допустимо
     использовать сокращенную запись -- всюду,  где это не оговорено  особо.
     При использовании сокращенной записи следует помнить,  что  недостающие
     элементы  будут  взяты  из  базового   адреса,   т.е.   из   переменной
     конфигурации Address,  которая указана  первой  в  файле  конфигурации.
     Например, при основном адресе 2:5030/143 запись /145 будет трактоваться
     Sf-Mail как 2:5030/145, а запись .3 -- как 2:5030/143.3.
         Так же при описании адресов в некоторых случаях можно  использовать
     символ замены `*'.  Ниже  приведен  список  всех  допустимых  вариантов
     использования символа замены  (здесь  и  далее  по  тексту  в  качестве
     базового адреса принят адрес 2:5030/143):

        *:*/*           - все узлы (3D-адрес)
        *:*/*.*         - все адреса (4D-адрес)
        2:*/*           - все узлы в зоне 2
        2:*/*.*         - все адреса в зоне 2
        2:5030/*        - все узлы в зоне 2 сети 5030
        2:5020/142.*    - все поинты узла 143 в 2:5030 сети
                          включая сам узел
        2:5030/*.0      - все узлы в 2:5030 сети, исключая поинтов

     ПРИМЕР (здесь и далее при основном адресе 2:5030/143):

        1:*/*.*         - все узлы и поинты в зоне 1;
        2:461/*         - все узлы в 2:461 сети;
        2:5030/143.*    - все поинты узла 2:5030/143;
        2:5020/*.0      - все узлы (и только узлы!) в сети 2:5020.

         Sf-Mail  воспринимает  некоторые  специальные  слова,  как  макросы
     адреса. К таким словам относятся:

        All            - все адреса (ан. *:*/*.*)
        MyZone         - все адреса в зоне основного адреса (ан. 2:*/*.*)
        MyNet          - все адреса в сети основного адреса (ан. 2:5030/*.*)
        MyPoints       - все поинты узла основного адреса (ан. 2:5030/143.*)

         Кроме простых масок адресов  Sf-Mail  может  распознавать  и  более
     сложные, в которых символ замены `*' используется не для всего поля,  а
     только для части. Например:

        2:50*/*.*      - весь 50-ый регион зоны 2
        2*:50*/10*.3*  - все поинты,  номер  зоны  которых  начинается  с  2
                         (например, 2, 20, 202), номер сети начинается с  50
                         (например, 50, 5030, 5020), номер узла начинается с
                         10  (например,  10,  103,  101),  а  номер   поинта
                         начинается с 3 (например, 3, 33,  31,  357).  Такой
                         маске удовлетворяет, например, адрес 29:501/109.390

         При необходимости исключения  адресов  из  списка  следует  указать
     символ `!' непосредственно перед маской адреса, например:

        !2:5030/142    - все адреса, исключая 2:5030/142
        !31:*/*.*      - все адреса, исключая узлы и поинтов зоны 31

         Все вышеприведенные сокращения и макросы  в  основном  используются
     при описании правил маршрутизации (см. X.Y.Z.), но полную запись адреса
     Sf-Mail поймет в любом месте файлов конфигурации.  И если Вы не уверены
     в том,  что в данном месте  допустимы  сокращения,  макросы  и  символы
     замены, пишите адрес полностью.

         Кроме вышеприведенных макросов Sf-Mail понимает еще три:

     Listed     - все известные адреса (т.е. описанные в каком-либо  из
                  подключенных нодлистов или в листе подстановок);

     Published  - все адреса, описанные в  каком-либо  из  подключенных
                  нодлистов, лист подстановок не учитывается;

     Protected  - все адреса, для которых заданы пароли в  подключаемом
                  переменной конфигурации Passwords секции Files списке
                  паролей.

         В дальнейшем будем называть список  адресов,  в  котором  допустимо
     использовать   три   вышеописанных   макроса,    группой   адресов   --
     AddressGroup.

         Теперь следует упомянуть о терминах,  которые  в  дальнейшем  будут
     использоваться при описании  параметров  файлов  конфигурации  Sf-Mail.
     Следует  помнить,   что  параметры  заключенные  в  квадратные  скобки,
     являются необязательными и могут быть опущены,  а параметры заключенные
     в угловые скобки -- обязательны и их необходимо указать.  Ниже приведен
     список типов параметров:

     TargetAddress
     ─────────────┘
         Полный 4D адрес или его сокращенная  запись.  Символы  подстановки,
     макросы и группы ЗАПРЕЩЕНЫ!

     НАПРИМЕР:

        2:5030/143     - узел 143 зоны 2 сети 5030
        /142           - узел 142 зоны 2 сети 5030
        .12            - поинт узла 143 зоны 2 сети 5030

     AddressList
     ───────────┘
         Список адресов  через  запятую.  Допустимо  использование  символов
     замены и макросов. Пробелы и группы ЗАПРЕЩЕНЫ!

     ПРИМЕРЫ:

       /142,/145,135:7000/4,135:7000/14
       1:*/*.*,MyZone,3:*/*.*
       MyPoints,31:3030/*.*,!31:3030/*.0

     AddressGroup
     ────────────┘
         Аналогично AddressList,  но с возможностью задания макросов listed,
     published, protected.

     ПРИМЕР:

       Listed,!Protected     - известные нам, но не защищенные паролем

     TimePeriod
     ──────────┘
         Временной интервал в формате:  d.hh:mm-d.hh:mm,  где d -- номер дня
     недели,  hh -- часы,  mm  --  минуты.  Дни  недели  нумеруются  с  нуля
     (воскресенье) и до шести  (суббота).  Если  номер  дня  не  указан,  то
     Sf-Mail  будет  считать,   что  указанный  интервал  времени  действует
     ежедневно.

     НАПРИМЕР,  запись  0.09:30-3.18:01 представляет собой интервал времени,
     который  читается  так:  с  воскресенья по среду с девяти часов утра до
     восемьнадцати  часов  одной  минуты  вечера. Т.е. каждый день в течении
     четырех дней с 9:00 до 18:01.

         При задании времени в поле часов рекомендуется всегда указывать две
     цифры,  например:  не 9:00,  а 09:00.  Этим Вы облегчите жизнь и себе и
     Sf-Mail при разборе конфигурационных установок.

     TimeList
     ────────┘
         Список   временных   интервалов,   разделенных   запятой.   Пробелы
     ЗАПРЕЩЕНЫ! Можно указать не более семи интервалов.

     НАПРИМЕР: 0.09:30-3.18:01,4.12:00-5.15:45,6.13:00-6.14:00

     OsCommand
     ─────────┘
         Имя программы для запуска или команда ОС. Параметры допускаются.

     НАПРИМЕР:  Del \BARDAK\*.*
                \SF-MAIL\Sf-Mngr 2:5030/145 -i -k -l

         ПРИМЕЧАНИЕ:   Во  всех  конфигурационных  файлах  командные  строки
     вносятся в двойные кавычки (символ `"').

     CfgWord
     ───────┘
         Имя переменной основного файла конфигурации Sf-Mail.  Будет описано
     ниже. (см. X.Y.Z.).


    x. Режимы работы

         Существует  два  основных  стиля  работы  ftn-совместимых  почтовых
     программ:  bink-style и arcmail-attach.  Каждый из них имеет  как  свои
     преимущества, так и недостатки.


    x.y. AMA

         Стиль arcmail-attach (сокращенно AMA)  подразумевает  использование
     писем с атрибутом file-attached для посылки файлов. Т.е. для того чтобы
     послать какой-либо файл, следует написать или создать письмо, которое в
     поле subj содержало бы полный путь и имя отправляемого файла и имело бы
     атрибут file-attached.
         AMA-мэйлеры  строят  очередь  на  основе  писем,   содержащихся   в
     нетмэйловом каталоге и сами создают почтовые пакеты (netmail bundles).
         Пакеты эхо-почты отправляются  таким  же  методом  --  для  каждого
     пакеты  создается   отдельное   письмо   с   атрибутом   file-attached,
     указывающее на него.
         Недостатки ama очевидны: на узле,  имеющем достаточно большое число
     линков,   приходится  держать  в  нетмэйловом  каталоге  слишком  много
     писем-аттачей, что сильно замедляет построение очереди.


    x.y. Bink-style

         Bink-style мэйлеры сами никак  не  взаимодействуют  с  нетмэйловыми
     письмами -- их обрабатывают  внешние  программы.  Очередь  создается  в
     результате сканирования исходящего  каталога  (bink  outbound  area)  и
     поиска там файлов с определенными именами.  Bink  outbound  area  имеет
     следующую структуру:

      ├─OUTBOUND\
      │ ├─nnnnffff.?ut
      │ ├─nnnnffff.?lo
      │ └─NNNNFFFF.PNT\
      │   ├─pppppppp.?lo
      │   └─pppppppp.?ut
      └─OUTBOUND.ZZZ\
        ├─nnnnffff.?ut
        ├─nnnnffff.?lo
        └─NNNNFFFF.PNT\
          ├─pppppppp.?lo
          └─pppppppp.?ut

         Поясним принципы формирования имен каталогов и файлов.  Для  каждой
     зоны в bink outbound area создается свой каталог, имя которого задается
     в  файле  конфигурации,   а   расширением   является   номер   зоны   в
     шестнадцатиричном представлении.  Так формируется  имя  для  всех  зон,
     кроме той,  к которой принадлежит основной адрес (main  address)  Вашей
     системы. Расширение этого каталога пустое.
         В   каждом   зональном   каталоге   могут   содержаться   файлы   с
     предопределенными  расширениями:  req,  ?lo  и  ?ut.   Знак  вопроса  в
     расширении означает,  что на этом месте должна стоять одна из букв,  по
     которой определяется атрибут  пакета  или  файла  для  отправки.  Имена
     файлов  складываются  из  номера  сети  и  узла,   для  которых   файлы
     предназначены,  в  шестнадцатиричном  виде.  Файлы  с  расширением  ?ut
     являются обычными почтовыми пакетами.  Файлы с  расширением  ?lo  имеют
     текстовый формат.  В каждой строке указывается полный путь и имя  файла
     для отправки.  Если в первой позиции указан `^',  то указанный  в  этой
     строке файл после отправки  будет  уничтожен.  Если  в  первой  позиции
     указан символ `#',  то после отправки  файл  будет  урезан  до  нулевой
     длины.  Если имя файла начинается с первой  позиции  строки,  то  после
     отправки с файлом ничего не произойдет.
         Bink-style имеет неоспоримые преимущества перед ama на  загруженных
     узлах с большим количеством линков.


    x.y. Sf-Mail mixed mode (tm)

         До Sf-Mail почтовые программы могли  работать  только  в  одном  из
     описанных выше режимов -- либо в bink-style либо в ama.  Мы постарались
     объединить эти два стиля и получился Sf-Mail mixed mode (tm). Смысл его
     в том,  что мэйлер одновременно обслуживает и binkley  outbound  и  сам
     может создавать и распаковывать почтовые пакеты.

     ПРИМЕЧАНИЕ: Если Вы включили поддержку bink-режима, то Sf-Mail   вместо
                 служебных  писем (Poll, FReq, Attach)  будет   генерировать
                 их эквиваленты для bink-style.


    x. Интерфейс пользователя

         Sf-Mail обладает уникальным  интерфейсом  пользователя.  Достаточно
     короткого  взгляда  на  основной  экран,   для  того  чтобы  однозначно
     определить состояние программы.


    x.y. Рабочий экран Sf-Mail

         Основной рабочий экран Sf-Mail содержит необходимое  и  достаточное
     для пользователя количество информации.
         В  самой  верхней   строке   экрана   слева   находится   фирменный
     идентификатор продукта,  а рядом в круглых  скобках  --  режим  работы,
     который может принимать значения:

       Ama       - только arcmail attach
       Bink      - только binkstyle
       Bink/Ama  - полная поддержка и ama и binkstyle
       Bink/Pack - binkstyle и внутренний запаковщик писем
       Bink/Unp  - binkstyle и внутренний распаковщик писем

         В правой части верхней строки отображается основной адрес  системы,
     который можно поменять на один из  Ваших  адресов,  описанных  в  файле
     конфигурации.  Для смены основного адреса  нужно  нажать  Ctrl/A  и  из
     предложенного списка выбрать нужный элемент.
         Третья строка экрана содержит текущие дату,  время и  если  Sf-Mail
     находится в сессии, то ее продолжительность.
         Наибольшее место  на  экране  отведено  под  журналы  активности  и
     ответов модема.  В журнале активности Sf-Mail фиксирует все  события  и
     действия,  выполняемые программой.  За небольшим  исключением  вся  эта
     информация дублируется в файле на диске.  Имя файла задается переменной
     конфигурации Log в секции Files.
         В  нижней  части  рабочего  экрана находится информация о последних
     входящей и исходящей сессиях в формате:
     <Адрес><Имя станции><Месторасположение><Индикатор успешности сессии>
     <Время и Дата сессии>.
         Строкой ниже отображается дополнительная  информация:  номер  линии
     (Task),  объем свободного пространства на диске,  на котором  находится
     каталог,   заданный  переменной  файла  конфигурации   Inbound   секции
     Directories (Free disk space),  время до очередного  исходящего  звонка
     (Timing), и количество свободной памяти (Mem).
         Минимальный объем  свободного  пространства  на  принимающем  диске
     задается переменной конфигурации Min_DiskSpace секции  Miscellaneous  и
     управляет разрешением приема файлов и почты. Т.е.  если свободное место
     на диске стало меньше,  чем указано в Min_DiskSpace,  Sf-Mail не  будет
     ничего принимать, а перейдет в режим `Только передача' (Send only). При
     этом  индикатор  свободного  пространства  будет  отображаться  красным
     цветом,  а в EMSI на удаленную машину будет передаваться флаг HAT (Hold
     All Traffic).
         В  самой  нижней  строке  экрана  отображается  полоса  индикаторов
     состояния модема (Modem  Status  Bar),  которая  включается  переменной
     конфигурации Modem_Lamps секции Modem.


    x.y. Горячие клавиши

         Основное  управление  Sf-Mail   осуществляется   при   помощи   так
     называемых `горячих клавиш' (hotkeys). Их список приведен ниже.


      ТАБЛИЦА 1. Управляющие клавиши в режиме ожидания (idle).
     ┌───────┬─────────────────────────────────────────────────────────────┐
     │Клавиши│                         Описание                            │
     ├───────┼─────────────────────────────────────────────────────────────┤
     │       │                                                             │
     │ F1    │ Вывод помощи по горячим клавишам.                           │
     │       │                                                             │
     │ Alt/X │ Инициализация модема.                                       │
     │       │                                                             │
     │ Alt/D │ Запуск программы, определенной переменной конфигурации      │
     │       │ Os_Shell секции Xternal_Programs.                           │
     │       │                                                             │
     │ Alt/E │ Запуск программы, определенной переменной конфигурации      │
     │       │ Msg_Editor секции Xternal_Programs.                         │
     │       │                                                             │
     │ Alt/U │ Запускает любую программу из командной строки.              │
     │       │                                                             │
     │ Alt/A │ Поднять трубку и ответить на звонок.                        │
     │       │                                                             │
     │ Alt/N │ Вывод информации об узле.                                   │
     │       │                                                             │
     │ Alt/P │ Формирование пустого элемента очереди для опроса узла.      │
     │       │                                                             │
     │ Alt/R │ Запрос файлов.                                              │
     │       │                                                             │
     │ Alt/S │ Отправка файлов.                                            │
     │       │                                                             │
     │ Alt/I │ Вывод истории входящих сессий.                              │
     │       │                                                             │
     │ Alt/O │ Вывод истории исходящих сессий.                             │
     │       │                                                             │
     │ Alt/Q │ Выход из Sf-Mail.                                           │
     │       │                                                             │
     │ Alt/Y │ Перепаковка почты.                                          │
     │       │                                                             │
     │ Space │ Сброс таймера ожидания  холостого  хода. При  этом  Sf-Mail │
     │       │ проверит, нет ли невыполненных событий, активных  элементов │
     │       │ очереди, и новых писем в каталоге netmail.                  │
     │       │                                                             │
     │ Enter │ Аналогично   Space,   но   если    определена    переменная │
     │       │ конфигурации   Bink_Outbound   секции    Directories,    то │
     │       │ происходит полное пересканирование исходящего каталога.     │
     │       │                                                             │
     │ BS    │ Включает режим сохранения экрана (Screen Saver).            │
     │       │                                                             │
     │ Ctrl/O│ Откладывает время очередного исходящего звонка на 1 час.    │
     │       │                                                             │
     │ Alt/T │ Запуск внешнего терминала. Задается переменной конфигурации │
     │       │ Terminal секции Xternal_Programs.                           │
     │       │                                                             │
     │ Alt/F1│ Редактирование строки инициализации модема N1. (InitStr1 в  │
     │       │ секции Modem).                                              │
     │       │                                                             │
     │ Alt/F2│ Редактирование строки инициализации модема N2. (InitStr2 в  │
     │       │ секции Modem).                                              │
     │       │                                                             │
     │ Alt/F3│ Редактирование строки инициализации модема N3. (InitStr3 в  │
     │       │ секции Modem).                                              │
     │       │                                                             │
     │ Alt/F4│ Редактирование строки, заставляющей модем поднять трубку  и │
     │       │ ответить на звонок. (Modem_Answer в секции Modem).          │
     │       │                                                             │
     │ Alt/V │ Просмотр статистики за текущий день.                        │
     │       │                                                             │
     │ +     │ Инкрементирование интервала между исходящими звонками на    │
     │       │ 1 секунду.                                                  │
     │       │                                                             │
     │ -     │ Декрементирование интервала между исходящими звонками на    │
     │       │ 1 секунду.                                                  │
     │       │                                                             │
     │ Ctrl/A│ Меняет основной адрес на один из заданных переменными       │
     │       │ конфигурациями Address секции General_Info.                 │
     │       │                                                             │
     │ Alt/F │ Включение/выключение режима принудительного ответа.         │
     │       │                                                             │
     │ Alt/C │ Изменение значения переменных конфигурации.                 │
     │       │                                                             │
     │ Alt/0 │ Меню пользователя. Позволяет выполнить действия,  описанные │
     │       │ в Файле Управления Процессами и назначенные  дополнительным │
     │       │ клавишам (см. ниже).                                        │
     │       │                                                             │
     │ Alt/K │ Полная переинициализация Sf-Mail: перечитывание всех        │
     │       │ конфигурационных файлов.                                    │
     │       │                                                             │
     │ Ctrl/P│ Включение режима Crash Poll.                                │
     └───────┴─────────────────────────────────────────────────────────────┘


      ТАБЛИЦА 2. Управляющие клавиши в режиме `Ответ На Звонок'.
     ┌───────┬─────────────────────────────────────────────────────────────┐
     │Клавиши│                         Описание                            │
     ├───────┼─────────────────────────────────────────────────────────────┤
     │       │                                                             │
     │ Esc   │ Обрывает ответ и переинициализирует модем.                  │
     │       │                                                             │
     │ Space │ Аналогично Esc.                                             │
     └───────┴─────────────────────────────────────────────────────────────┘


      ТАБЛИЦА 3. Управляющие клавиши в режиме `Сессия' (On-Line).
     ┌───────┬─────────────────────────────────────────────────────────────┐
     │Клавиши│                         Описание                            │
     ├───────┼─────────────────────────────────────────────────────────────┤
     │       │                                                             │
     │ Esc   │ Оборвать сессию. (Только во время работы протокола          │
     │       │ передачи).                                                  │
     │       │                                                             │
     │ Alt/H │ Повесить трубку и проинициализировать модем.                │
     │       │                                                             │
     │ Alt/S │ Пропустить текущий принимаемый файл. (Skip File).           │
     │       │                                                             │
     │ Ctrl/S│ Аналогично Alt/S, но недопринятый файл стирается.           │
     │       │                                                             │
     │ Tab   │ Отображение дополнительной информации об удаленной станции  │
     │       │ в окне протокола.                                           │
     └───────┴─────────────────────────────────────────────────────────────┘


    x. Настройка цветов

         Настройка цветов Sf-Mail осуществляется переменными основного файла
     конфигурации в секции Colors.  Каждая из этих  переменных  задает  цвет
     одного  или  нескольких  видимых  элементов  на  экране.   Кроме  того,
     переменная Blinking управляет режимом мерцания.
         Мы  рекомендуем  подключать  секцию  Colors  с  помощью   директивы
     #include -- это позволит Вам менять  раскладки  цветов  с  минимальными
     затратами.
         Подробности  см.   в  комментариях  к  переменным   секции   Colors
     дистрибутивного файле конфигурации.


    x. Нодлист, лист подстановок

         Для  нормальной  работы  Sf-Mail  требует  наличия  хотя  бы одного
     нодлиста  и  индекса, созданного программой sf-nc.exe (Sf-Mail Nodelist
     Compiler), которая поставляется в дистрибутивном пакете.
         Информация    об     узлах,     содержащаяся     в     подключенных
     ноде-/поинт-листах,   будет  использоваться  Sf-Mail  для   определения
     телефонов, времени и других параметров работы узлов.
         Кроме ноде-/поинт-листов в состав конфигурационных  файлов  Sf-Mail
     может  входить  лист  подстановок  (substitute  list),   информация  из
     которого  дополняет  и/или  перекрывает   информацию,   находящуюся   в
     ноде-/поинт-листе.


    x.y. Форматы ноде-/поинт-листов

         Для успешного построения индекса ноде-/поинт-листов и  последующего
     доступа к информации об узлах  необходимо,  чтобы  подключаемые  списки
     узлов имели корректную структуру.
         Для  поинт-листов  необходимо  наличие  ключевого  слова Boss перед
     каждым  блоком  описаний  поинтов, а каждая строка, описывающая поинта,
     должна начинаться со слова Point.
         К  структуре  ноде-листов  нет  каких-либо особых требований, кроме
     того, что они должны удовлетворять fts-0005.


    x.y. Построение индекса списка узлов

         Построение индекса списка узлов производится программой sf-nc.  exe
     (SantaFox Nodelist  Compiler),  поставляемой  в  дистрибутивном  пакете
     Sf-Mail.
         Перед  запуском  построителя  индекса  нужно  подредактировать  его
     управляющий файл (sf-nc.cfg), задав все необходимые установки. Описания
     ключевых слов sf-nc.exe содержаться в файле sf-nc.cfg.
         При запуске  построителя  индекса  в  командной  строке  необходимо
     указать одну из опций:

      -C  -- Conditional compile. Sf-nc проверит, совпадают ли по датам ранее
             подключенные ноде-/поинт-листы и если хотя бы у  одного  из  них
             дата изменилась, то индекс будет перестроен.

      -F  -- Forced compile.  Sf-nc  не  будет  ничего  проверять,  а  просто
             перестроит индекс.


    x.y. Лист подстановок (substitute list)

         Лист подстановок подключается  к  Sf-Mail  переменной  конфигурации
     SubstList секции Files и содержит дополнительную информацию о некоторых
     адресах.

         Формат описаний параметров узлов в substlist:

     <address> <parameters>

     где:

     <address>    - Полный 4D адрес системы; Должны быть указаны зона,
                    сеть, узел и если это поинт, то и его номер.
                    НАПРИМЕР:

                     2:5030/142   - узел 142
                     2:5030/143.1 - первый поинт узла 143

        ВНИМАНИЕ! адрес 2:5030/142 не равен 2:5030/142.0
        ────────

     <parameters> - Различные параметры; их синтаксис приведен ниже.

         Если строка заканчивается символом `+' (плюс),  то следующая за ней
     считается ее продолжением.

         Символ `;' (точка с запятой) считается началом  комментария  и  вся
     информация правее его игнорируется.

         Наряду с перекрытиями параметров для  адресов,  в  substlist  можно
     указывать переопределение некоторых дней. Формат строки переопределения
     дня выглядит так:

     DAY  <day>.<month>  <day_of_week>

      где:

     DAY           - Ключевое слово, говорящее Sf-Mail о том, что
                     данная строка переопределяет день;

     <day>.<month> - День и месяц, для которых мы хотим переопределить  день
                     недели;

     <day_of_week> - День недели, который будет присвоен дате <day>.<month>

         Вышеописанная  возможность  может  быть  успешно   использована   в
     ситуации, когда из-за праздников рабочие и выходные дни переносятся.

     ПРИМЕР:

      Day  8.05  1   ; 8 мая == понедельник
      Day  9.05  0   ; 9 мая == воскресенье


         Параметры и их возможные значения:

     Time       Интервалы времени работы станции.
     ────┘      Синтаксис:
                  Time <TimeList>

                ПРИМЕР:
                  2:5030/145  Time 1.22:00-5.09:30,6.00:00-0.23:59

     Hidden     Начинает описание параметров дополнительной линии.
     ──────┘
                ПРИМЕР:
                  2:5030/142  Hidden Time 1.18:00-5.07:00,6.00:00-0.23:59

     Phone      Заменяет телефон из нодлиста. Этот номер не транслируется.
     ─────┘     Синтаксис:
                  Phone <PhoneNumber>

                ПРИМЕР:
                  2:5030/143.1  Phone 555-8913

     Dial       Префикс для набора номера. При звонке на  этот  адрес  будет
     ────┘      использоваться этот  префикс  вместо  указанного  переменной
                конфигурации Dial_Perfix секции Modem.
                Синтаксис:
                  Dial <DialPrefix>

                ПРИМЕР:
                  2:5030/142  Hidden Dail AT&N6DT

     Wait       Время  ожидания  несущей  при  звонке  на  этот  адрес.   (в
     ────┘      секундах)
                Синтаксис:
                  Wait <Time>

                ПРИМЕР:
                  2:5030/142.142  Wait 76

     FReq       Время обслуживания файловых запросов этой станцией.
     ────┘      Синтаксис:
                  FReq <TimeList>

                ПРИМЕР:
                  2:5030/143      FReq 18:30-05:00,08:00-09:00
                  2:5030/142.142  FReq CM

     ZMode      Устанавливает режим работы ZModem в сессии с этим адресом.
     ─────┘     Синтаксис:
                  ZMode <Mode>
                Допустимые значения <Mode>:
                  NORM  - блоки стандартного размера;
                  MIN   - размер блока равен половине максимального
                          для скорости соединения;
                  MAX   - размер блока равен двум максимальным
                          для скорости соединения;
                  ZMO   - запрещает использование протоколов ZedZap
                          и DirZap для данного адреса;
                          Будет использоваться только 1k-ZModem.

                ПРИМЕР:
                  2:5030/142.142  ZMode MIN

     Flags      Устанавливает для адреса флаги в дополнение  к  указанным  в
     ─────┘     нодлисте.  Флаги  перечисляются   через   запятую,   пробелы
                запрещены.
                Синтаксис:
                  Flags <FlagsList>

                ПРИМЕР:
                  2:5030/142  Flags MO,H16

     Tries      Определяет к-во попыток прозвонки на этот адрес.
     ─────┘
                ПРИМЕР:
                  2:5030/143  Tries 103

     MinBaud    Определяет минимальную скорость соединения этого узла.
     ───────┘   Для основной линии:
                 можно указать минимальную скорость как на входящих,  так  и
                 на исходящих сессиях.  Формат  записи  для  основной  линии
                 такой:

                  MinBaud <in[/out]>

                 Если указано только  одно  число,  то  оно  трактуется  как
                 минимальная скорость на исходящих сессиях.

                Для дополнительных линий:
                 можно  указывать  только  один  параметр,   который   будет
                 трактоваться как минимальная скорость на исходящих сессиях.
                 Формат записи для дополнительной линии:

                  MinBaud <out>

                Минимальную скорость для входящих сессий можно задать только
                для основной линии,  т.к.  при  входящем  звонке  невозможно
                определить, какая именно линия удаленной системы нам звонит.

                ПРИМЕРЫ:
                 2:5030/142  MinBaud 14400/19200 +
                             Hidden Phone 123-4567  MinBaud 33600

     Limit      Определяет лимит  времени  исходящих  и  входящих  сессий  с
     ─────┘     данным узлом в минутах.
                Синтаксис аналогичен MinBaud (см. чуть выше).

                ПРИМЕР:
                 2:5030/142  Limit 60/15 +
                             Hidden Phone 123-4567  Limit 60

         Слово Hidden используется  для  задания  параметров  дополнительных
     линий,  которых может быть до  восьми.  В  общем  случае  строка  файла
     substlist имеет вид:

     <address> <main line parametres> [+]
               [Hidden specific parametres for hidden line 1][+]
                 ::::::::::::::::
               [Hidden specific parametres for hidden line n]

         Параметры  основной  линии  задаются  в  <main  line   parameters>.
     Описание параметров каждой дополнительной  линии  начинается  со  слова
     Hidden.  Для каждой дополнительной линии  должен  быть  указан  телефон
     (Phone), в противном случае, Sf-Mail не будет туда звонить.

         Приведем пример описания многолинейного узла:

                 ; дополнения для основной линии:
     2:5030/142  Dial AT&N6DT Flags H19,MO +
                 ;
                 ; первая дополнительная линия:
                 Hidden Phone 123-4567 Time CM ZMode MIN +
                 ;
                 ; вторая дополнительная линия:
                 Hidden Phone 987-6543 Time 1.18:00-5.07:00,6.00:00-0.23:59+
                 ;
                 ; третья дополнительная линия:
                 Hidden  Time CM FReq 00:00-05:00 Phone 222-3232


    x. Очередь

         Очередь является одним  из  базовых  понятий  практически  в  любой
     почтовой программе.  Она определяет  поведение  мэйлера  для  исходящих
     звонков.   Именно   активные   элементы   очереди   принуждают   мэйлер
     осуществлять исходящие звонки.


    x.y. Создание очереди

         Очередь формируется Sf-Mail при упаковке писем,  просмотре файловых
     ящиков (FileBoxes) и Bink-outbound каталогов (при работе  в  Bink-style
     или Sf-Mail Mixed Mode).
         Каждый элемент очереди имеет  адрес  назначения  и  список  файлов,
     которые должны быть отправлены на этот адрес.
         Для подготовки  почтовых  пакетов  обычно  используется  внутренний
     упаковщик -- Sf-Mail Internal Mail  Packer,  но  его  можно  отключить,
     указав в переменной конфигурации  AMA_Support  секции  System  значение
     None или UnPack.  В этом случае очередь  будет  создаваться  на  основе
     содержимого bink-outbound и файловых ящиков.
         При  включенном  внутреннем  упаковщике  (AMA_Support  установлен в
     Pack)  каждый  Rescan_Period  Sf-Mail  просматривает  основной почтовый
     каталог,  заданный переменной конфигурации NetMail секции Directories и
     ищет  там  новые,  еще  не  запакованные  письма. Если таковые имеются,
     Sf-Mail  анализирует  адреса  отправителя  и назначения письма, флаги и
     отдает  письмо  внутреннему  упаковщику,  который просматривает правила
     маршрутизации,  на  их основе определяет, куда и как должно уйти данное
     письмо,  запаковывает  его  в  соответствующий почтовый пакет и создает
     элемент очереди, если на этот адрес его еще не существует.
         Письма   с   атрибутом   Crash   и/или   флагом   IMMediately    не
     маршрутизируются,  т.е.  Sf-Mail поступает с ними так,  как если бы они
     имели флаг DIRect.


    x.y.z. Правила маршрутизации (Route.ctl)

         Файл, подключаемый переменной конфигурации RoutingList секции Files
     содержит набор правил,  говорящих встроенному упаковщику,  куда  и  как
     отправлять те  или  иные  письма.  Так  же  возможно  маршрутизация  по
     умолчанию, которая будет использоваться упаковщиком в том случае,  если
     он не нашел правила, соответствующего письму.

         Маршрутизация в общем случае происходит следующим образом:

     1) Определяются адреса отправителя и назначения письма;
     2) Просматриваются  правила  маршрутизации,  действующие  в  данный
        момент;
     3) Если правило найдено, то письмо упаковывается в пакет для адреса,
        указанного в найденном правиле;
     4) Если правило не найдено, то действует маршрутизация по-умолчанию;

     ПРИМЕЧАНИЕ:  Маршрутизация по-умолчанию подразумевает следующую схему:
     ──────────    a) почта для поинтов маршрутизируется на их боссов;
                   b) почта для узлов маршрутизируется на их хабов.

         При поиске правила просматриваются сверху-вниз, т.е. в том порядке,
     в котором они описаны  в  файле  Route.cfg,  поэтому,  описание  правил
     следует строить по принципу `От Частного -- К Общему', например:

         ; -----------------------------------------------------------------
         ; Это пример НЕПРАВИЛЬНО построенных правил. Здесь Sf-Mail  никогда
         ; не будет выполнять второе правило, т.к., найдя первое, он  дальше
         ; смотреть не будет
         ;
         Route-to 2:5030/142  2:*
         Direct   2:5030/145,/74,/133
         ; -----------------------------------------------------------------

         ; -----------------------------------------------------------------
         ; А вот то же самое, записанное ВЕРНО:
         ;
         Direct   2:5030/145,/74,/133
         Route-to 2:5030/142  2:*/*.*
         ; -----------------------------------------------------------------


         Ниже приведен список команд маршрутизации.

     Direct          <AddressList> [TimePeriod]
     ──────
         Направить  письма  для  узлов  из  AddressList  напрямую  во  время
     TimePeriod.

     НАПРИМЕР:

         Direct  /142,/145   00:00-23:59
         Direct  MyNet  00:00-23:59

     Route-to        <TargetAddress> <AddressList> [TimePeriod]
     ────────
         Отправлять  все  письма,   адреса  назначения  которых  указаны   в
     AddressList, на адрес,  указанный в TargetAddress во время,  заданное в
     TimePeriod.

     НАПРИМЕР:

         Route-to   /142  2:*/*.*,!2:5030/103   00:00-23:59

     Route-from      <TargetAddress> <AddressList> [TimePeriod]
     ──────────
         Отправлять все письма от адресов, указанных в AddressList на адрес,
     указанный в TargetAddress во время, указанное в TimePeriod.

     НАПРИМЕР:

         Route-from  /969  /961,/962,/963,/964  00:00-08:30
         Route-from  2:5030/142  !2:5030/74.22

     Direct-files    <AddressList> [TimePeriod]
     ────────────
         Не  маршрутизировать  файловые  аттачи  для   адресов   из   списка
     AddressList во время, заданное TimePeriod.

     НАПРИМЕР:

         Direct-files  2:5030/*.0  23:30-04:00

     Files-to        <TargetAddress> <AddressList> [TimePeriod]
     ────────
         Файлы  для  узлов  из  списка  AddressList  направлять   на   адрес
     TargetNode.

     НАПРИМЕР:

         Files-to  /142  /103,/142.*  00:00-23:59
         Files-to  /103  /103.*   00:00-23:59

         Если  правила   Files-to   и/или   Direct-files   не   заданы,   то
     маршрутизация аттачей (и ArcMail attach'ей) идет _по  умолчанию_,  т.е.
     если аттач для поинта -- маршрутизируем на его босса,  если  аттач  для
     узла -- маршрутизируем на его хаба.

         Во  всех  вышеописанных  правилах  параметр   TimePeriod   является
     необязательным и может  быть  опущен.  В  таком  случае  правило  будет
     действовать постоянно. Тем не менее, мы настоятельно рекомендуем всегда
     указывать время действия правила.

         В некоторых особых случаях встроенный  упаковщик  почты  игнорирует
     правила маршрутизации.  К таким случаям относятся  письма  с  атрибутом
     Crash и флагами IMMediately и  DIRect.  С  письмами,  имеющими  атрибут
     Crash и/или флаг IMMediately Sf-Mail поступает так,  как  если  бы  они
     имели флаг DIRect.
         Кроме этого,  наличие этих атрибутов и  флагов  влияет  на  порядок
     обработки очереди,  т.е.  на порядок производства исходящих звонков,  о
     чем будет сказано немного позже.


    x.y.z. Расширенная маршрутизация

         Расширенная  маршрутизация   включается   переменной   конфигурации
     Advanced_Routing секции Miscellaneous  и  подразумевает  дополнительное
     правило:

       Все письма с атрибутом DIRect, адресованные поинтам, телефон  которых
       неизвестен (-Unpublished-), а так же узлам, которые имеют статус PVT,
       HOLD  или  DOWN и не прописанные в листе подстановок маршрутизируются
       на их боссов/хабов соответственно.

         По умолчанию расширенная маршрутизация отключена.  При  этом  такие
     письма будут выложены на холд.


    x.y.z. Файловые ящики

         Файловые ящики  являются  альтернативным  средством  для  пересылки
     файлов и могут использоваться наряду с *.?LO и file-attached  messages.
     Идеология файловых ящиков такова:  для каждого адреса может быть создан
     специальный каталог с  уникальным  именем,  содержимое  которого  будет
     передано на данный адрес при ближайшей сессии. Каталоги файловых ящиков
     формируются утилитой SfmAttch посредством перевода адреса назначения  в
     32-ричную  систему  счисления.   Это   позволяет   Sf-Mail   однозначно
     транслировать имя ящика в 4D-адрес.
         Файловые  ящики  могут  быть  двух  типов:  активные  и  неактивные
     (холдовые).  Содержимое ящика любого  типа  образует  элемент  очереди.
     Различие состоит в  том,  что  содержимое  активных  ящиков  заставляет
     Sf-Mail звонить на этот адрес,  а содержимое неактивных  --  нет.  Т.о.
     неактивные  файловые  ящики  можно  рассматривать,   как  file-attached
     messages с атрибутом HOLD. А активные -- без этого атрибута.
         Следует отметить, что после передачи файлы из ящика будут удалены и
     если ящик не содержит файлов, то и он сам будет удален с диска.
         Месторасположение каталога,  в котором  будут  находиться  файловые
     ящики  задается  переменной  файла   конфигурации   File_Boxes   секции
     Directories.  Этот каталог  является  корневым  для  ящиков,  т.е.  все
     каталоги файловых ящиков должны находиться  внутри  его.  По  умолчанию
     переменная File_Boxes имеет пустое значение и это значит,  что файловые
     ящики Sf-Mail поддерживать не будет.


    x.y.z. Named polls (tm)

         Named poll предоставляет уникальную возможность поставить  в  общую
     очередь прозвонки элементы,  не являющиеся  узлами  ftn-сети.  Основные
     принципы работы named poll  таковы:  в  каталоге,  заданном  переменной
     Flags_Dir секции Directories Sf-Mail ищет файлы  с  расширением  np?  и
     использует их имена (до восьми символов)  для  отображения  в  качестве
     элемента очереди. Последняя буква pасшиpения указывает номеp линии, для
     котоpой создан Named Poll. Файл,  создающий named poll должен  иметь  текстовый
     формат и содержать в себе всю необходимую информацию для  осуществления
     звонка по этому элементу очереди.

         Структура *.np?:

     1я строка: Dial prefix
     2я строка: Phone number
     3я строка: Program to run after CONNECT

         Т.е.  в первых двух строках указывается префикс набора номера и сам
     телефонный номер, по которому Sf-Mail будет звонить, а в третьей строке
     указывается  командная  строка  программы,   которая   будет   запущена
     непосредственно после появления несущей.

         Например:

     --- 8< ---- uucico.np0 ---- 8< ---
     ATDt
     278-9012
     cico.btm
     --- 8< -------------------- 8< ---

         Named poll обрабатываются Sf-Mail так же,  как и остальные элементы
     очереди, но не могут иметь атрибутов, таких как IMMediate, HOLD и т.п.


    x.y.z. Атрибуты (флаги) узлов в очереди

         Кроме списка писем и файлов для отправки  каждый  адрес  в  очереди
     может  содержать  и  атрибуты.   Атрибуты  служат  для  более   гибкого
     управления исходящими звонками и могут быть установлены как  оператором
     с клавиатуры, так и самим Sf-Mail в процессе работы.
         Всего поддерживается пять атрибутов:

      IMMediate
      ─────────┘
         Адрес с этим атрибутом будет  включен  в  список  активных  адресов
     независимо от времени работы узла и наличия действующей в данный момент
     команды hold в файле маршрутизации (Route.ctl).  Разумеется,  если узел
     не имеет телефона (т.е.  его телефонный  номер  определен  в  нодлисте,
     как -Unpublished-), то Sf-Mail не будет туда звонить.
         Этот атрибут может быть установлен только оператором с  клавиатуры.
     Sf-Mail его обрабатывает,  как описано выше,  но сам его  поставить  не
     может.

      PRIOrity
      ────────┘
         Адрес  с  этим  атрибутом  заставляет  Sf-Mail   игнорировать   всю
     остальную очередь и звонить только на этот адрес. При наличии в очереди
     нескольких адресов с  атрибутом  PRIOrity  из  них  будет  сформирована
     альтернативная очередь,  которая и будет обрабатываться мэйлером до тех
     пор, пока не останется ни одного элемента с атрибутом PRIOrity. Атрибут
     PRIOrity  не  заставляет  Sf-Mail  игнорировать   время   работы   узла
     назначения и если в данный момент этот узел  не  принимает  звонки,  то
     атрибут будет проигнорирован.
         Атрибут  PRIOrity  может  быть  поставлен   только   оператором   с
     клавиатуры. Sf-Mail обрабатывает этот атрибут, как указано выше, но сам
     его никогда не ставит.

      HOLD
      ────┘
         Заставляет  Sf-Mail  исключить  адрес  из  списка  активных.   Т.е.
     исходящие звонки на этот адрес производиться не будут.
         Атрибут HOLD может быть установлен как оператором с клавиатуры, так
     и самим Sf-Mail в качестве реакции на  принятый  во  время  EMSI-сессии
     флаг HAT, трактуемый:  `Hold All Traffic' (Удаленная система работает в
     режиме Только Пеpедача).

      HRQ
      ───┘
         Аббревиатура HRQ происходит от английского Hold ReQuests. Как можно
     догадаться из названия,  атрибут HRQ заставляет Sf-Mail  не  отправлять
     файловые запросы (File Requests) на этот адрес.  Т.о.  при  наличии  на
     адрес,  имеющий атрибут HRQ,  только файловых запросов Sf-Mail исключит
     этот адрес из списка активных и звонить туда не будет.
         Этот атрибут обычно выставляется самим Sf-Mail в ответ на пришедший
     во  время  EMSI-сессии  флаг  HRQ.   Этим  флагом   удаленная   система
     сигнализирует о том,  что в данный момент времени она  не  поддерживает
     файловые запросы.

      HXT
      ───┘
         Атрибут HXT  трактуется,  как  Hold  Compressed  Traffic,  т.е.  не
     отправлять файлы.
         Обычно этот атрибут выставляется Sf-Mail,  как реакция на  принятый
     во время EMSI-сессии одноименный флаг.

         Допустимо совместное использование атрибутов IMMediate и  PRIOrity.
     Использование атрибута HOLD вместе с другими не  имеет  эффекта,  кроме
     приостановки выходящих звонков на данный адрес. Т.е. атрибут HOLD имеет
     наивысший приоритет по отношению к IMMediate, PRIOrity, HXT и HRQ.
         Все атрибуты действуют  в  течение  времени,  заданного  переменной
     конфигурации HIP_Time секции  Miscellaneous,  с  момента  их  установки
     оператором или самим Sf-Mail.


    x.y. Управление очередью

         Обычно  очередью  управляет  сам  мэйлер  --  формирует  и  удаляет
     элементы, ставит и снимает атрибуты, осуществляет исходящие звонки и т.
     д. В подключаемом файле маршрутизации (Route.ctl) имеется набор команд,
     которые позволяют Sf-Mail изменять порядок исходящих звонков.  К  таким
     командам относятся:

      Hold         <AddressList>  [TimePeriod]
      ────┘
         Предотвращает исходящие звонки на адреса,  указанные в  AddressList
     во время TimePeriod.

      UnHold       <AddressList>  [TimePeriod]
      ──────┘
         Служит для отмены команды Hold для адресов из списка AddressList во
     время TimePeriod.

     ПРИМЕР:

        ;┌Поинт /143.10 работает круглосуточно (CM),
        ;│=> имеет смысл прозваниваться к нему сразу, как только
        ;│для него появилась почта/файлы/фреки.
         UnHold .10
        ; ──────────────────────────────────────────────────────
        ;┌Остальные поинты будут сами забирать,
        ;│Sf-Mail им звонить не будет никогда:
         Hold   MyPoints
        ; ──────────────────────────────────────────────────────
        ;┌Днем я не желаю звонить ни на какую станцию,
        ;│кроме /142 и 135:7000/2, пропишу так:
         UnHold  /142 135:7000/2  09:00-18:00
        ; ──────────────────────────────────────────────────────
        ;┌Остальные будут задержаны до 18oo:
         Hold  All  09:00-18:00

      Immediate    <AddressList>  [TimePeriod]
      ─────────┘
         Заставляет Sf-Mail игнорировать время  работы  узлов,  описанных  в
     AddressList во время, указанное в TimePeriod. Например, мы хотим, чтобы
     Sf-Mail звонил на все адреса за один час до ZMH,  в  надежде,  что  они
     принимают в это  время  звонки.  Фрагмент  route.ctl  для  этого  может
     выглядеть так (предположим, что период ZMH == 06:30-07:30):

        Immediate  All  05:29-06:29

     ПРИМЕЧАНИЕ:    Команда Immediate будет действовать только в том случае,
                    если у нас есть активная  (нехолдовая)  почта/файлы  для
                    этого узла.

         Исходящие  звонки  осуществляются  в  цикле  с  периодом,  заданным
     переменной конфигурации CallPeriod секции  Miscellaneous.  Каждый  цикл
     Sf-Mail просматривает очередь и ищет в ней  адреса,  которые  в  данный
     момент времени могут принять исходящую почту, файловые аттачи, файловые
     запросы, т.е. активные адреса. Если такой адрес найден, Sf-Mail звонит.
         Есть некоторые  особые  случаи,  когда  порядок  обработки  очереди
     изменяется. Например,  присутствие в исходящем потоке писем с атрибутом
     Crash заставляет Sf-Mail звонить только на этот узел до тех  пор,  пока
     он не отдаст это письмо или оно не будет удалено оператором.  Письма  с
     флагом IMMediate заставляют Sf-Mail игнорировать время  работы  станции
     назначения.
         Ручное  управление  очередью  заключается  в  установке  и   снятии
     атрибутов элементов очереди,  перемещении указателя текущего  элемента,
     удалении и перепаковке почтовых пакетов, формировании файловых аттачей,
     файловых запросов и пустых поллов изнутри Sf-Mail.
         Не  смотря  на  такой  широкий  набор  возможностей   для   ручного
     управления очередью,  мы  придерживаемся  концепции:  `Очередь  --  для
     мэйлера'.  Именно поэтому очередь не отображается  на  основном  экране
     Sf-Mail.  Мы  считаем,  что  при  корректных  настройках  вмешательство
     оператора в работу мэйлера не требуется.


    x. Особенности работы под различными ОС

         Sf-Mail имеет встроенные  средства  взаимодействия  практически  со
     всеми известными мультизадачными/мультипользовательскими  операционными
     системами.   Это  как  широкоизвестные   системы,   так   и   известные
     ограниченному числу специалистов.  Благодаря  этому  Sf-Mail  корректно
     работает  в  многозадачной  среде,  оптимально  используя  ресурсы  ОС.
     Однако, некоторые ОС благодаря своему внутреннему устройству,  не могут
     обеспечить приемлемое качество работы программ без их тонкой  настройки
     (практически все продукты фирмы Microsoft).  Далее мы дадим  конкретные
     рекомендации по оптимальной настройке Sf-Mail для работы под некоторыми
     ОС.


    x.y. Microsoft Windows 3.1x

         Для устойчивой работы Sf-Mail,  как и любого  другого  мэйлера  под
     данной ОС с высокоскоростным модемом мы  рекомендуем  Вам  использовать
     модем (если внутpений, иначе плата COM-порта) с микросхемой имеющей FIFO.
     Также мы рекомендуем Вам использовать fossil-драйвер имеющий  поддержку
     FIFO.

         Вот несколько общих рекомендаций при работе под Windows 3.1x

      a) Фоссил необходимо загружать до запуска Windows;
      b) Модем должен иметь FIFO;
      c) Мы рекомендуем установить  степень  заполнения  FIFO  равную  8,  а
         скорость `залочить'. Например для популярного фоссила X00:

               X00 E F=8 R=4096 T=2048
               XU LOCK:1:38400:8N1

         Что означает "залочит" COM2 на скорость 38400,  установить  уровень
         срабатывания FIFO равное 8.

      d) Мы не рекомендуем лочить порт на скорость большую чем 38400.

         Далее Вам  нужно  изменить/добавить  некоторые  параметры  в  файле
     system.ini ОС Windows.

         В секции [386Enh] добавте/измените следующие параметры:

               MinTimeSlice=10
               COMxFIFO=1
               COMBoostTime=1

         Вместо `x' во  второй  строке  выпишите  номер  порта,  на  котором
     установлен Ваш модем.  Например,  COM1FIFO=1 для COM1.  Если у Вас  нет
     FIFO то вторая строка должна выглядеть так:

               COMxFIFO=0

         Стандартные прерывания (IRQ) для COM1, COM3 = 4,  для COM2,  COM4 =
     3.  Если Ваш  модем  использует  нестандартное  для  данного  COM-порта
     прерывание, то Вам необходимо указать в файле system.ini:

               COMxIRQ=X
     где:
          x  -- номер вашего COM-порта
          X  -- номер прерывания.

         Кроме того,  мы рекомендуем Вам использовать  файл  sf-mail.pif  из
     нашего дистрибутива для  запуска  Sf-Mail.  Для  этого  Вы  должны  его
     подредактировать в PifEditore  Windows  --  Вам  необходимо  проставить
     правильный путь до sf-mail.exe.

     ПРИМЕЧАНИЕ: Мы настоятельно рекомендуем Вам использовать видео-драйвер,
                 приобретенный вместе с Вашей видеокартой, а не  стандартный
                 из поставки Windows 3.1x.

    x.y. DesqView 386/286

         Для успешной работы под DesqView Вам необходимо при инсталляции  DV
     ответить  утвердительно  в  пункте  OptimizeCommunications.   Также  мы
     советуем Вам использовать модем с FIFO и  все  рекомендации  касающиеся
     фоссила перечисленные в предыдущем подпункте (см. X.Y.Z.).
         Для  запуска  Sf-Mail  под  DV  мы  рекомендуем  Вам   использовать
     sf-mail.dvp входящий в дистрибутив нашего продукта.
         Для инсталляции  sf-mail  в  список  программ  DV,  Вам  необходимо
     сначала установить sf-mail на Вашем жестком диске. Затем,  запустив DV,
     выполнить следующие шаги:

     a) Выбрать в меню DV пункт `Open Window' и войти в него;
     b) Выбрать пункт меню `Add a Program' и войти в него;
     c) Нажать клавишу `O' (Other Program);
     d) После этого появится приглашение набрать путь к программе.
     e) Наберите полный путь к директории, в которой находится  sf-mail.dvp,
        но не заканчивайте этот путь символом `\'.
     f) После этого в меню  появится  надпись  `Santa  Fox  Mail'  (если  их
        появится две, что  может  быть  если  в  этой  же  директории  лежит
        pif-файл для  Windows  3.1x,  то  выберете  левый),  опустите  линию
        подсветки на эту строку и нажмите пробел.
     g) Переместите линию подсветки на пункт меню "DONE" и нажмите `Enter'.

         Теперь в меню DESQ, в списке программ вы увидите Santa Fox Mail.

         Теперь выберете пункт меню "Change a Program" и войдите в него. Там
     Вам  необходимо  прописать  правильное  имя   директории,   в   которой
     находится,  собственно,  файл Sf-Mail.exe.  Опять же,  имя должно  быть
     полным, т.е. содержать имя диска, и НЕ заканчиваться символом `\'.
         Если  необходимо,   то  там  же  в   установках   поменяйте   номер
     коммуникационного  порта,  вписав  тот,  на  котором  стоит  модем  (по
     умолчанию стоит `Y',  но если у Вас модем на порту 1  или  2  то  лучше
     поставить конкретное значение).
         Так же Вам следует учесть, что объем обычной и расширенной памяти в
     файле sf-mail.dvp поставлен из расчета на то,  что Вы будете  запускать
     внешние процессы из мэйлера как отдельные задачи DV,  в независимых  от
     мэйлера окнах (см.  X.Y.Z.  `Запуск Внешних Процессов' ниже).  Если  Вы
     хотите запускать внешние процессы обычным досовским  способом,  то  Вам
     надлежит увеличить поле MinMEMSize до 350 килобайт (размер  подбирается
     эксперементально),  а поле Exp Mem до 512 kB  (зависит  от  потребности
     запускаемых внешних процессов, а также от ключей свопинга).
         Так же вы можете в параметрах DV установить  OptimizeCommunications
     в Yes.  Мы рекомендуем Вам дополнительно ознакомиться с  рекомендациями
     по использованию конкретного фоссил-драйвера с  DV  в  документации  на
     этот драйвер.
         Соотношение Back-/Fore-ground мы рекомендуем установить в  2/2  или
     4/2.

     ПРИМЕЧАНИЕ: Если  у  Вас  компьютер  оснащен  процессором  286   и   Вы
                 используете DesqView 286, то Вам  дополнительно  необходимо
                 изменить установки файла sf-mail.dvp:

               Writes text directly to screen      [N]
               Virtualize text/graphics (Y,N,T)    [N]


    x.y. IBM OS/2 ver 2.xx, ver 3.xx

         Особых настроек под OS/2 Sf-Mail не требует.  Приведем  лишь  общие
     рекомендации.
         Используйте коммуникационные драйвера Рэя Гвинна (Ray  Gwinn).  Это
     драйвера OS/2: физического устройства SIO.SYS,  виртуального устройства
     VSIO.SYS, а также драйвер дос VX00.SYS (обеспечивает интерфейс FOSSIL).
         В установках OS/2  для  Sf-Mail  (Settings)  рекомендуем  поставить
     переменную Session Priority примерно в два раза выше, чем по умолчанию,
     но можно и больше,  например,  10.  Sf-Mail  сам  отдаст  ненужное  ему
     процессорное время и не будет замедлять другие  приложения.  Переменную
     конфигурации ReleaseTQ_Method в файле конфигурации Sf-Mail лучше  всего
     установить в значение `DEF':

               ReleaseTQ_Method   DEF

         Переменную Time_Quant в значение 0 (означает значение по умолчанию,
     для OS/2 это 55 миллисекунд)

               Time_Quant  0

         При оптимальных настройках во время сессии счетчик байтов  (в  окне
     протокола) должен обновляться после отсылки/приема каждых 50..150 байт.
     Если счетчик обновляется реже и/или наблюдается падение CPS при  работе
     мэйлера в  фоне,  мы  рекомендуем  Вам  уменьшить  значение  переменной
     Time_Quant (по умолчанию 55 миллисекунд). Например:

               Time_Quant  30

         Если-же наблюдается обратный эффект, т.е. происходит слишком частое
     обновление счетчика и/или наблюдается большая  загрузка  процессора  то
     увеличьте значение переменной Time_Quant. Например:

               Time_Quant  100

         Вы  можете  поэкспериментировать  с  установками  переменных   OS/2
     SessionPriority и Sf-Mail'а Time_Quant.


    x.y. TSX-32 Lite, Multitasker-Multiuser OS by S&H Technology

         Для успешной работы Sf-Mail под  данной  операционной  системой  мы
     советуем Вам запускать мэйлер с помощью комбинации BAT  и  CMD  файлов.
     BAT файл Вам понадобится потому,  что TSX не умеет корректно  запускать
     резидентные программы (каковым  является  фоссил-драйвер)  без  запуска
     командного процессора дос.  Что-бы  справится  с  этой  проблемой,  Вам
     следует создать BAT-файл следующего содержания:

      -----------
       @echo off
       rem Запускаем фоссил с залочкой на 57600, FIFO на 1/2
       BNU /R:4096 /T:512 /P:1 /L:1=57600,8N1 /Z2
       rem Запускаем мэйлер
       sf-mail.exe
      -----------

         Также  мы  рекомендуем  Вам  создать  CMD-файл,  из  которого будет
     запускаться вышеописанный BAT-файл:

      -----------
       CurrentDir = $CWD()
       CurrentId = $Jobinfo( "JOBID" )
       OldName = $Jobinfo( "PNAME" )
       set process/identification='CurrentId'/name="SantaFoxMailer"
       set process/maxttchk=500/nobell/nottfwbell
       set working_set/noadjust
       Start:
       run/nodwrite/holdpriority/ttwait/ttckio/iopriv %COMSPEC% sf-mail.bat
       cd 'CurrentDir'
       set process/identification='CurrentId'/name="''OldName"
      -----------

         Данные файлы входят в поставку Sf-Mail.

         Кроме этого,  мы рекомендуем выключить эмуляцию FIFO или установить
     уровень его срабатывания на 1.  Для этого Вам надо запустить  системную
     программу TSGEN и в  конце  списка  Tuning  parammeters  найти  секцию,
     отвечающую за Virtual UART.
         Под данной ОС мы советуем Вам поставить  Time_Quant=0  (Default)  и
     ReleaseTQ_Method=DEF,   однако,   Вы  можете   попробовать   установить
     ReleaseTQ_Method в HLT.

    x.y. Microsoft Windows-95

         Под Windows-95 не рекомендуется использовать  фоссилы  X00  и  BNU.
     Возможно использование фоссила LLCLCOM.  При этом y Вас будут прекрасно
     работать  лампочки  и  не   будет   наблюдаться   никаких   проблем   с
     инициализацией модема.  LLCLCOM  рекомендуется  загружать  из  того  же
     BAT-файла что и Sf-Mail.  Не используйте опции LLCLCOM,  такие как  /SM
     (Smart), а также /BP (Boost priority).  Что касается опции /BP то можно
     попробовать ее использовать,  но врядли она даст результат и уж конечно
     ничего не даст под WindowsNT.

         Примерная строка запуска может быть такой:

               LLCLCOM /P:3 /LK:38400:8N1 /TSZ:8192 /RSZ:8192

         Можно попробовать установить Transmit Buffer Low  Water  Mark,  что
     может снизить загруженность системы при передаче. Пример:

               LLCLCOM /P:3 /LK:38400:8N1 /TSZ:8192 /TLM:2048 /RSZ:8192

         При оптимально настроенной системе Вы должны получить загруженность
     в 4-10% при приеме и 10-25% при передаче.  При фоновой загрузке  (когда
     не запущено никакой другой  программы  кроме,  собственно,  Windows-95)
     загруженность не должна  превышать  1%.  Это  все  верно  для  скорости
     приема/передачи 16800 bps.
         Так-же можно применить  фоссил  VFOSSIL,  выполненный  в  виде  VxD
     драйвера.  Мы тестировали Sf-Mail  с  VFOSSIL  версии  1.08.  При  этом
     параметры VFOSSIL ставились по умолчанию.  Однако,  для успешной работы
     связки   Sf-Mail+VFOSSIL   потребовалось   отключить    ModemLamps    в
     sf-mail.cfg. Иначе были проблемы с инициализацией модема. Также следует
     отметить,  что  проблемы  с  инициализацией  модема  при  использовании
     VFOSSIL наблюдались даже после этого,  но гораздо в меньшей  степени  и
     пусть не с первой попытки  но  мэйлер  мог  проинициализировать  модем.
     Какие плюсы при использовании VFOSSIL? Во-первых,  Вы сможете наблюдать
     статус порта и передачи данных в System Monitor, во-вторых,  примерно в
     два раза уменьшается  загруженность  системы  на  передаче.  На  приеме
     выигрыша он практически  не  дает.  С  WinFossil  Sf-Mail  авторами  не
     тестировался.


    x.y. Установка параметров Time_Quant и ReleaseTQ_Method
         в файле Sf-Mail.cfg

         Переменные  Time_Quant  и  ReleaseTQ_Method  управляют  методом   и
     количеством отдачи процессорного времени операционной системе.

         Переменная Time_Quant задает время,  которое  будет  отдаваться  ОС
     мэйлером. То-есть,  когда мэйлер находится в цикле ожидания какого либо
     события (прерывания клавиатуры,  данных из модема и т.д.)  он  вызывает
     внутреннюю функцию отдачи свободного времени. Переменная Time_Quant как
     раз и определяет время,  через которое мэйлер опять получит  управление
     (на это время процессор переходит в пользование другой задаче).
         Все  выше  сказанное  справедливо  при  ReleaseTQ_Method,  задающем
     отдачу фиксированного времени.
         Мы рекомендуем Вам присваивать устанавливать Time_Quant в  значение
     ноль,  т.к.  в этом случае Sf-Mail присвоит сам подставит  значение  по
     умолчанию,  которое будет являться оптимальным для каждой  операционной
     системы.  Если же Вы хотите сами  менять  эту  переменную  то  прочтите
     следующее.

         Число,   присваемое  Time_Quant  есть  время  в  миллисекундах  для
     следующих ОС:

        ОС                                     Значение по умолчанию
        ────────────────────────────────────────────────────────────
        OS/2                                           55 mS
        PC-MOS/386                                     55 mS
        European MS-DOS 4.0                            55 mS
        DoubleDos                                      55 mS
        RTS-386                                        55 mS

         Некоторые  ОС  не  позволяют  конкретно  задать  время,   для   них
     Time_Quant есть некая абстрактная величина от 0 до 65535,  и чем больше
     ее значение, тем меньше времени отнимает у ОС мэйлер.

        ОС                                     Значение по умолчанию
        ────────────────────────────────────────────────────────────
        DesqView                                       255
        Windows 3.1x                                   255
        MS-DOS 5 or above                              255
        IPX Relinquish                                 255

         Мы Вам советуем использовать установку Time_Quant=0.

         Что  касается  переменной  ReleaseTQ_Method,   то  устанавливая  ее
     соответствующим образом,  Вы принудительно выбираете тот или иной метод
     отдачи процессорного времени. Приведем лишь рекомендации:

      -  Для Windows 3.1x в случае  сильного  `засыпания'  мэйлера  советуем
         поставить HLT или I28.

      -  Для RTS-386 мы настоятельно рекомендуем HLT.

      -  Для OS/2 вы можете использовать HLT, I28 или I2F,  но  лучше  всего
         использовать значение по умолчанию.

         Допустимые значения переменной ReleaseTQ_Method:

      HLT       -- отдача времени через инструкцию процессора HLT
      I28       -- через прерывание `Dos Idle' Int28h
      I2F       -- через Int2Fh AX=1680h (Generic)
      IPX       -- отдача времени сетевому драйверу
      DEF       -- по умолчанию, т.е. Sf-Mail сам выбирает метод

         Остальные значения не могут быть установлены  и  игнорируются.  При
     установке в DEF переменной  ReleaseTQ_Method,  Sf-Mail  сам  определяет
     способ отдачи времени в зависимости  от  ОС  под  которой  он  запущен.
     Sf-Mail идентифицирует следующие ОС:

      OS/2
      DesqView
      PC-MOS/386
      Windows or other supported 1680h int2fh
      Windows-95 / WindowsNT
      MS-DOS 5 or above
      Eropean MS-DOS 4.0
      DoubleDos
      RTS-386

     Некоторые замечания по OS/2:

         Под OS/2 очень плохо работают методы HLT,  I28 и  I2F,  поэтому  мы
     НАСТОЯТЕЛЬНО рекомендуем Вам использовать  значение  DEF,  то  есть  по
     умолчанию.  В этом случае мэйлер будет использовать специальный сервис,
     предоставляемый OS/2 и ресурсы будут расходоваться очень экономно.

    x.y. Запуск внешних процессов

         Под   внешними   процессами   подразумеваются   исполняемые   файлы
     (программы),  пакетные файлы и команды  ОС.  Т.к.  Sf-Mail  всего  лишь
     мэйлер,  то  для  нормальной  работы  ему  необходимо  уметь  запускать
     программы, которые бы обрабатывали почту и принимаемые файлы.
         Так же,  как мы снабдили нашу программу средствами распознавания ОС
     и отдачи timeslice  штатными  методами  этих  ОС,  мы  научили  Sf-Mail
     запускать внешние процессы,  используя особенности наиболее  популярных
     операционных систем. Кроме того,  при запуске внешних процессов Sf-Mail
     может ориентироваться на файловые семафоры.
         В общем виде строка запуска внешних процессов выглядит так:

     [<F>FlagName,<F>FlagName,..] {Options} Command_Line

         Семафоры должны  указываться  в  квадратных  скобках,  опции  --  в
     фигурных.

     FlagName -- имя файлового семафора;
     <F>      -- идентификатор действия, один из указанных ниже:
                  +  -- создать семафор с именем FlagName;
                  -  -- удалить семафор с именем FlagName;
                  !  -- запустить процесс  только  при  отсутствии  семафора
                        FlagName;
                  &  -- запустить  процесс  только  при   наличии   семафора
                        FlagName;
                  ~  -- создать  семафор  с   именем   FlagName,   запустить
                        процесс, дождаться исчезновения созданного  семафора
                        и только после этого продолжать работу.

     ПРИМЕЧАНИЕ: Все файловые семафоры создаются и ищутся только в каталоге,
                 заданном переменной  файла  конфигурации  Flags_Dir  секции
                 Directoies.  Имя  семафора  должно  удовлетворять  правилам
                 MS-DOS  для  имен  файлов  и  не  должно  включать  в  себя
                 устройство и путь.

     ПРИМЕРЫ:

       При запуске создать семафор <Flags_Dir>\arcmail.flg:

         [+arcmail.flg]...

       При  запуске  создать  семафор  <Flags_Dir>\arc_tic.flg   и   удалить
       <Flags_Dir>\arcmail.flg:

         [+arc_tic.flg -arcmail.flg]...

       Запустить процесс только в том случае, если в данный момент  FastEcho
       не активная (т.е. если отсутствует семафор <Flags_Dir>\febusy.0):

         [!febusy.0]...

       <Options> -- опции  запуска,  которые  указывают  метод   запуска   и
                    свопинга, используя специфические особенности ОС.

         Опции для запуска задаются в фигурных скобках непосредственно перед
     именем запускаемой программы.

                   Ниже приведен полный список опций запуска:

      #  Создать  семафор  с  именем  запускаемой   программы,   ничего   не
         запускать.

      !  Запуск программы без командного интерпретатора.

      ^  Принудительно закрыть коммуникационный канал перед запуском.

      v  Переинициализировать коммуникационный канал после возвращения.

      .  Перед запуском модему будет  послана  строка,  заданная  переменной
         конфигурации Off_Hook секции Modem, а по возвращению будет  послана
         строка, заданная переменной конфигурации On_Hook секции Modem.

      L  Дописать информацию из внутреннего лог-буфера в файл журнала.

                           Опции управления свопингом:

      X  Разрешить свопинг в XMS.

      E  Разрешить свопинг в EMS.

      B  Разрешить свопинг в EXT (используя верхнюю память  через  BIOS  Int
         15, когда нет менеджеров памяти, но физически дополнительная память
         присутствует).

      H  Разрешить свопинг на жесткий диск.

      N  Запретить любой свопинг. (Запуск без свопинга).

         При неудачной  попытке  засвопиться  в  память,  будет  предпринята
     попытка сделать своп-файл на диске.  При  отсутствии  флагов  свопинга,
     будет разрешен свопинг по полной программе XMS-EMS-EXT-HDD.

                  Опции для запуска в мультизадачных системах:

      D  - Запуск DVP программы с установками DVP файла.

      >  - Запуск DVP и OS/2 программы в качестве фонового процесса.

      <  - Запуск DVP программы в режиме Hidden.

      O  - Запуск OS/2 программы.

      M  - Запуск DOS-программы под OS/2.

      W  - Запуск OS/2 и DOS программ в режиме Windowed.

      ПРИМЕЧАНИЕ: Для запуска OS/2 программ не напрямую, а через  cmd.exe  в
                  окружении должна быть определена переменная  `OS2COMSPEC',
                  Вы  можете  задать  ее  в  bat-файле:  Set  OS2ComSpec   =
                  Y:\OS2\CMD.EXE. В случае если Вы запускаете что-либо через
                  cmd.exe надо учесть, что текущим  каталогом  является  C:\
                  Опция  {D}  имеет  наивысший  приоритет  для  запуска  DVP
                  программ, если Вы хотите  запустить  dvp-файл  в  фоне  то
                  используйте {>}some.dvp

         Учитывая эти возможности,  мы можем задать  различные  реакции  при
     работе под различными ОС.

     ПРИМЕРЫ (по причине ограничения на ширину страницы
              длинные строки приведены с переносами)

      ; ======================== sf-mail.cfg ===============================
      ;
      [Xternal_Programs]
      (os2)           Msg_Editor    '{O}(Fido_dir)\GOLD\GoldEd.cmd'
      (dv)            Msg_Editor    '{D}C:\DV\Ge-pif.dvp'
      (dos,win)       Msg_Editor    '(Fido_dir)\GOLD\GoldEd.bat'
      (os2)           OS_Shell      '{O}d:\OS2\NEMO\Nemo.exe'
      (dos,win)       OS_Shell      '{!}C:\DN\Dn.com'
      (dv)            OS_Shell      '{D}C:\DV\Dn-pif.dvp'

      ;========================= process.cfg ===============================
      ;
      ; Запускается по пpинятию ArcMail`а
      ;
      (DV)      [ArcMail] Run '[+toss.sem]{L!>}D:\FECHO\Fe-pif.dvp in'
      (DOS,WIN) [ArcMail] Run '[+toss.sem]{L}.\Toss.bat'
      (OS2)     [ArcMail] Run '[+toss.sem]{>OL}D:\MAIL\SF-MAIL\Toss.cmd'
      (W95)     [ArcMail] Run '{L}start /m .\Toss.bat'
      ;
      ; Запускается по пpинятию *.TiC`ов
      ;
      (DV)      [Tic]     Run '{L!>}D:\ALLFIX\Tic.dvp'
      (DOS)     [Tic]     Run '{L}.\Tic.bat'
      (OS2)     [Tic]     Run '{>OL}D:\SF-MAIL\Tic.cmd'
      (W95)     [Tic]     Run '{L}start /m .\Tic.bat'
      ;
      ; Запуск редактора конфигов
      ;
      (OS2)     [Key:0005] Run '{M}Sfm_Ed.exe' ;Ctrl/E  Config Files Editor
      (DOS,WIN) [Key:0005] Run 'Sfm_Ed.exe'    ;Ctrl/E  Config Files Editor
      ;
      ;Запуск файлреквестера
      ;
      (DOS,WIN) [Key:0006] Run 'Fusl.exe'            ;Ctrl/F  Request Files
      (W95)     [Key:0006] Run 'start /max Fusl.exe' ;Ctrl/F  Request Files
      (OS2)     [Key:0006] Run '{!LM}Fusl.exe'       ;Ctrl/F  Request Files
      ;
      ;Тоссинг почты на выход
      ;
      (DOS,WIN) [Key:0012] Run '[+toss.sem]FEcho.bat out'
                               ;Ctrl/R  Rescan Message Base
      ;
      (DV)      [Key:0012] Run '[+toss.sem]{L!>}FE-pif.dvp out'
                               ;Ctrl/R - Rescan Message Base
      ;
      (W95)     [Key:0012] Run 'start /m D:\FIDOMAIL\FECHO\FEcho.bat out'
                               ;Ctrl/R - Rescan Message Base Background
      ;
      (OS2)     [Key:0012] Run '[+toss.sem]{LO}D:\FECHO\FEcho.cmd out'
                               ;Ctrl/R - Rescan Message Base Background
      ;
      ; Просмотр лога sf-mail
      ;
      (OS2) [Key:0016] Run '{LM}D:\TW\Tw.exe F:\LOG\Sf-Mail.log'
                           ;Ctrl/V - View Sf-Mail Log File
      ;
      ; Тоссинг почты на выход по семафорам
      ;
      (DOS,WIN) [Flag:echotoss.log] Run '[+toss.sem]\FECHO\FEcho.bat out'
      (OS2)  [Flag:echotoss.log] Run '[+toss.sem]{L>O}\FECHO\FEcho.cmd out'
      (W95)  [Flag:echotoss.log] Run 'start /m \FECHO\FEcho.bat out'
      (DV)   [Flag:echotoss.log] Run '[+toss.sem]{L>!}\DV\FE-pif.dvp out'
      ;
      ; Паковка базы по семафорам
      ;
      (DOS,WIN) [Flag:pack.sem] Run '[!toss.sem]\FECHO\Pack.bat'
      (OS2)  [Flag:pack.sem] Run '[!toss.sem]{L>O}\FECHO\Pack.cmd'
      (DV)   [Flag:pack.sem] Run '[!toss.sem]{L>!}\FECHO\Pk-pif.dvp'
      ;
      ; Компиляция ноделиста голдеда по семафору
      (OS2)  [Flag:nodelist] Run '{O>!}D:\GOLD\Gn2.exe -f -d'


         Обычно при запуске программы ей передаются  параметры  в  командной
     строке.  Иногда необходимо передать вызываемому  процессу  динамические
     параметры, полученные в ходе работы Sf-Mail.  Это реализуется с помощью
     специальных макросов, имена которых начинаются с символа звездочка `*'.
         Список макросов параметров:

     *P - номер коммуникационного порта (нумерация начинается с 1);
     *T - номер линии;
     *B - скорость текущего или последнего соединения;
     *A - адрес станции, с которой была последняя сессия;
     *N - 0 если последняя сессия была неуспешной, 1 в противном случае;
     *С - полное имя конфигурационного файла;
     *Q - имя  принятого  файлового  запроса  (работает  только  с   внешним
          реквест-процессором);
     *S - название станции, с которой идет или прошла сессия;
     *O - имя оператора станции, с которой идет или прошла сессия;
     *X - SECURE если  сессия  защищена  паролем,  и  UNSECURE  в  противном
          случае;
     *R - файл ответа от внешнего реквест-процессора;
     *J - телефон станции, с которой идет или прошла сессия;
     *I - INBOUND если сессия входящая, и OUTBOUND в противном случае.


    x.y. Коды выхода, возвращаемые при запуске внешних процессов

         При запуске  внешних  процессов  интеллектуальный  модуль  свопинга
     Sf-Mail возвращает код завершения запускаемого  процесса,  по  которому
     можно  определить  успешность   завершения.   В   большинстве   случаев
     возвращаемое   значение   является   кодом   (errorlevel)    завершения
     отработавшего процесса.  Это положительное число в интервале  от  0  до
     255.  В случае  если  мэйлер  не  смог  запустить  внешний  процесс  то
     возвращаются следующие коды (вы их можете увидеть на экране мэйлера как
     Return with errorlevel: XXX):

       NOSWAP   = 8000h (-32768) некуда свопиться -- не совпадает
                        разрешенное и существующее;

       NOCHNGMCB= 8001h (-32767) не изменить размер блока памяти;

       NOTMEM   = 8002h (-32766) нет места ни в памяти ни на диске;

       EMOVXMS  = 8003h (-32765) ошибка перемещения в XMS;

       EMOVEMS  = 8004h (-32764) ошибка перемещения в EMS;

       EMOVHDD  = 8005h (-32763) ошибка свопинга на диск;

       EMOVEXT  = 8006h (-32762) ошибка свопинга в EXT-память;

       EFREEXMS = 8007h (-32761) ошибка при попытке освободить XMS;

       EFREEEMS = 8008h (-32760) ошибка при попытке освободить EMS;

       EFREEHDD = 8009h (-32759) невозможно удалить своп-файл;

                  8102h (-32510) запускаемый файл не найден;

                  8103h (-32509) неправильно указан путь;

                  8104h (-32508) слишком много открытых файлов;

                  8105h (-32507) доступ закрыт;

                  8107h (-32506) разрушение управляющего блока памяти (MCB);

                  8108h (-32505) недостаточно памяти;

                  810Ah (-32504) некорректное окружение;

                  810Fh (-32503) не существующее устройство;

         При выходе  с  фатальными  (см.  ниже)  ошибками  мы  в  мэйлер  не
     возвращаемся.  При этом своп-модуль мэйлера  выдает  сообщение  в  виде
     строки:

            UniSwap Fatal. ErrorSig: #<буква >

         Список фатальных ошибок модуля свопинга:

       DOUBLERR = Z  Двойная ошибка (произошедшая в обработчике  ошибок  при
                     попытке ликвидировать последствия первой ошибки);

       NORSTMCB = Y  Не восстановить прежний размер блока памяти;

       NORSTXMS = X  Не вернуть из XMS засвопленый блок;

       NORSTEMS = W  Не вернуть из EMS засвопленый блок;

       NORSTHDD = V  Не вернуть с диска засвопленый блок;

       NORSTEXT = U  Не вернуть из EXT-памяти засвопленый блок;


    x.y. Файл управления процессами

         Файл управления процессами служит для запуска  внешних  программ  и
     переопределения   значений   переменных   конфигурации   Sf-Mail    при
     возникновении определенных условий.  Процессы отрабатываются менеджером
     процессов по требованию ядра Sf-Mail.
         Условия  и  соответствующие  им  команды   описываются   в   файле,
     подключаемом   через   переменную   конфигурации    Processes    секции
     Xternal_Programs.  Управляющий файл  состоит  из  строк,  в  каждой  из
     которых описаны условия и команда.
         Каждая строка может содержать  комментарии,  которые  начинаются  с
     символа `;' (точка с запятой) и продолжаются до конца строки.

         В общем случае строка определения процесса имеет вид:

     (OSid,Line)  [Reason] Cmd Params

         Рассмотрим каждый элемент вышеприведенной строки.

     OSid,    Список операционных систем и линий  для  которых  эта  команда
     Line     будет  отрабатываться.  Идентификаторы  ОС  и   номера   линий
              отделяются друг от друга запятыми. Если это поле  отсутствует,
              Sf-Mail будет считать, что  строка  относится  ко  всем  ОС  и
              линиям.

     Reason   Поле содержит список условий, заключенный в квадратные скобки;
              если условий несколько, то они должны быть  отделены  друг  от
              друга запятыми.

     Cmd      Это поле определяет реакцию Sf-Mail на событие и  может  иметь
              одно из значений:

                Run  -- запустить что-либо;  командная  строка  для  запуска
                        должна быть заключена в кавычки, если  она  содержит
                        пробелы. В противном случае кавычки можно  опустить,
                        например:

                          Run "C:\Command.com /p"
                          Run C:\DOS\Command.com

                Set  -- поменять значение переменной; имя  переменной  и  ее
                        новое значение  должно  быть  заключено  в  кавычки,
                        например:

                          Set  "Sound_Control  0";

                        или:

                          Set  "Station  'GameOver BBS'"

                Drop -- удалить пустые письма, *.?lo и *.?ut, созданные  для
                        активизации исходящих звонков;

                Poll -- создать  пустое  письмо  (или  *.?lo,   *.?ut)   для
                        активизации опроса узла;

                Xit  -- выход с определенным errorlevel`ом.

     Params - Параметры, необходимые для отработки  команды,  заданной  Cmd.
              Для Run это командная строка запуска  программы,  для  Xit  --
              errorlevel, для  Drop  --  список  адресов,  для  Set  --  имя
              переменной и ее новое значение.

         Условия,  обрабатываемые менеджером  процессов,  подразделяются  на
     группы:

      keypress       -- нажата какая-либо клавиша, не  обрабатываемая  ядром
                        Sf-Mail

      after_session  -- во время сессии получены какие-либо файлы

      xternal_mailer -- после появления несущей (при  выходящем  звонке  или
                        при ответе на звонок) от  удаленной  системы  пришло
                        ключевое слово

      semaphore      -- обнаружен файловый семафор

         Допустимо комбинировать различные условия,  но важно  помнить,  что
     команда выполниться только в том случае,  если  одновременно  выполнены
     все  условия.  Например,   команда  [Key:011B,NetMail]  Run  "Oops.bat"
     никогда не будет выполнена, т.к.  указанные условия не могут возникнуть
     одновременно.


    x.y.z. Условия группы keypress.

         Группа  keypress  содержит  одно  условие  --  key,  формат  записи
     которого имеет вид:

      [Key:KeyCode] Cmd Params

    где Key     -- ключевое слово;
        KeyCode -- скан-код (в  hex-виде)  клавиши,  нажатие  которой  будет
                   вызывать реакцию менеджера процессов;
        Cmd     -- реакция на нажатие клавиши;
        Params  -- параметры для Cmd.

         Комментарии в строках,  определяющих процессы  по  клавишам  крайне
     желательны, т.к.  их текст будет использоваться в качестве пунктов меню
     при нажатии Alt/0 (User menu -- см. X.Y.Z., таб. 1).
         Коды  клавиш  задаются  четырехзначным  шестнадцатиричным   числом,
     которое можно получить с помощью программы AsciiKod.exe, поставляемой в
     дистрибутивном пакете Sf-Mail.

         Описание события по нажатию клавиши может выглядеть так:

      [Key:0021] Set 'SoundControl 0'    ; Shift/1 - выключить все звуки

         При  нажатии  на  клавишу  с  кодом  0021  (это  Shift/1)  значение
     переменной конфигурации SoundControl будет установлено в  0,  т.е.  все
     звуковые эффекты будут запрещены.
         При вызове User menu (по клавише Alt/0)  в  качестве  пункта  меню,
     соответствующего   вышеприведенной    команде,    будет    отображаться
     комментарий, т.е. строка после символа `;'.
         Если Вы не указали комментарий для процесса,  вызываемого клавишей,
     то при вызове пользовательского меню (по Alt/0) в качестве пункта  меню
     менеджер процессов будет отображать саму команду.


    x.y.z. Условия группы after_session.

         Условия данной группы возникают после окончания сессии  и  являются
     реакцией  Sf-Mail  на  принятые  файлы.  Ключевые  слова,  определяющие
     условия:

       NetMail  -- принят хотя бы один почтовый пакет;
       EchoMail -- принят хотя бы один пакет эхо-почты;
       Tic      -- принят хотя бы один tic-файл;
       File     -- принят  хотя  бы  один  файл,  удовлетворяющий  указанной
                   маске.

         Четыре   условия   группы   after_session    позволяют    выполнить
     определенные действия,  если во  время  сессии  были  приняты  почтовые
     пакеты,  эхо-мэйл и/или тик-файлы.  Так же можно определить необходимые
     действия в случае, если были приняты файлы с именами,  подпадающими под
     заданную Вами маску.

         Формат записи условий:

      [NetMail]     Run  C:\SF-MAIL\Net.bat
      [ArcMail]     Run  C:\SF-MAIL\Toss.bat
      [Tic]         Run  C:\SF-MAIL\Tic.bat
      [File:*.exe]  Run  C:\SF-MAIL\BTM\Must_Die.bat

         Условия  NetMail,   ArcMail  и  Tic  можно  комбинировать,   в  чем
     собственно и состоит их основная мощь, например:

      [NetMail,ArcMail]  Run  C:\SF-MAIL\Toss.bat
      [NetMail]          Run  C:\SF-MAIL\Net.bat

         Если во время сессии получены  нетмэйл  и  эхомэйл,  то  выполнится
     команда, описанная в первой строке примера,  а вторая команда вообще не
     будет выполнена, т.к. флаги наличия условий сбросятся. Если же во время
     сессии получен только нетмэйл, то первая команда не выполнится вообще.
         Такая  возможность  может  быть  использована,  например,   если  в
     качестве эхопроцессора используется FastEcho,  которая имеет встроенный
     AreaFix. Т.е. его достаточно запустить всего один раз, указав не только
     команду распаковки принятых эхо-пакетов,  но и опцию обработки запросов
     к areafix.
         Условие File выполняется только  в  том  случае,  когда  за  сессию
     принят хотя бы один  файл,  соответствующий  заданной  маске.  Проверка
     файла на совпадение с маской происходит по правилам MS-DOS.

         Пример:

     [File:Points.*]  Run  C:\SF-MAIL\BTM\Copy_Pts.bat

         - если во время сессии был принят хотя бы один файл,  имя  которого
     соответствует  маске  Points.*,  то  после  завершения  сессии  Sf-Mail
     запустит командный файл C:\SF-MAIL\BTM\Copy_Pts.bat.


    x.y.z. Условия группы xternal_mailer.

         Условия данной группы  возникают,  когда  после  появления  несущей
     (DCD) от модема пришла  строка,  нераспознаваемая  ядром  Sf-Mail.  Эта
     строка передается менеджеру процессов, который проверяет, определена ли
     реакция на полученную строку.  Если такая строка определена,  то  будет
     выполнено соответствующее действие, например:

     [xMailer:TELEREPLICA]  Run  C:\BBS\TLRPL\Tel_Host.exe

         т.е. при получении строки `TELEREPLICA' будет запущена программа C:
     \BBS\TLRPL\Tel_Host.exe


    x.y.z. Условия группы semaphore.

         Каждый Rescan_Period Sf-Mail заглядывает  в  каталог,  определенный
     переменной файла конфигурации Flags_Dir и ищет  там  семафоры,  которые
     описываются в файле Управления Процессами.  При  обнаружении  семафора,
     Sf-Mail выполнит действие, предписанное в Process.ctl. Например:

     [Flag:reboot.now]  Xit  79

         --  при  обнаружении  семафора  с  именем  reboot.now  в   каталоге
     <Flags_Dir> Sf-Mail выйдет с errorlevel 79.

         Условие Flag удобно комбинировать с командой Drop и  предшествующим
     вызовом внешнего мэйлера Uucp.  Т.е.  Вы присваиваете фиктивному адресу
     телефон хоста uucp,  на который Вам нужно периодически  прозваниваться,
     создаете пустое письмо для опроса этого адреса (poll, см. ниже),  после
     удачного соединения с удаленной uucp по событию xMailer  Вы  запускаете
     через пакетный файл свою часть программы uucp,  которая  завершается  с
     определенным  errorlevel.   Возвращенный  errorlevel  анализируется   в
     пакетном файле и если он сигнализирует об успешном  завершении  сессии,
     то выставляется файловый семафор.  После возврата  в  Sf-Mail  менеджер
     процессов обнаруживает выставленный семафор и  выполняет  команду  drop
     для уничтожения пустого письма, созданного для опроса хоста uucp,  дабы
     предотвратить последующие звонки на хост.

     ПРИМЕЧАНИЕ: Иногда  бывает  необходимо  заставить  Sf-Mail   перечитать
                 основной файл конфигурации. Как это  сделать,  допустим,  с
                 удаленного терминала, ведь Process.ctl  не  предусматривает
                 команды перечитывания файла конфигурации? Не  отчаивайтесь!
                 Мы предусмотрели и это. Для того, чтобы  заставить  Sf-Mail
                 перечитать  основной  конфигурационный   файл,   достаточно
                 удалить  его  откомпиллированный  вариант  --  sf-mail.biN.
                 Sf-Mail обнаружит его исчезновение и примет соответствующие
                 меры -- перечитает файл конфигурации и откомпиллирует его.

         Реакция  Sf-Mail  на  условия  может  быть  различной  для   разных
     операционных систем.  Например,  если Sf-Mail  работает  под  OS/2,  то
     логичнее  использовать  эхопроцессор  для  этой  ОС.   Если  же  работа
     происходит под DOS,  то эхопроцессор для OS/2  не  сможет  запуститься.
     Поэтому реализована возможность выбирать,  какой именно  будет  реакция
     Sf-Mail на условие в зависимости от ОС.

         Например:

     (DOS,WIN) [NetMail,ArcMail]  Run  C:\SF-MAIL\Toss.bat
     (OS2)     [NetMail,ArcMail]  Run  {O>}Y:\FE\Fe_TA.cmd  ; toss + afix
     (DOS,WIN) [NetMail]          Run  C:\SF-MAIL\Net.bat
     (OS2)     [NetMail]          Run  {O>}Y:\FE\FE_A.cmd   ; afix

         Как видно из  примера,  идентификаторы  ОС  записываются  в  начале
     строки,  разделяясь  запятыми.   По  умолчанию  (если  не  указаны  ОС)
     считается, что условие действует под всеми операционными системами.
         Распознаваемые идентификаторы ОС приведены в Таблице .

        ТАБЛИЦА 4. Идентификаторы Операционных Систем.
       ┌─────────────┬────────────────────────┐
       │Идентификатор│   Операционная система │
       ├─────────────┼────────────────────────┤
       │     OS2     │  IBM OS/2              │
       │     WIN     │  MS-Windows 3.xx       │
       │     W95     │  Windows-95/Windows-NT │
       │     DV      │  DesqView              │
       │     LNX     │  Linux                 │
       │     DOS     │  MS-DOS                │
       └─────────────┴────────────────────────┘

         Кроме разделения процессов по ОС Sf-Mail позволяет разделить  их  и
     по линиям -- при работе на многолинейном узле.  Как  уже  было  сказано
     выше,  номера линий  записываются  в  первом  поле  описания  процесса,
     отделяясь через запятую друг от друга и от идентификаторов ОС.

     Например:

     (OS2,1,3,5)  [Flag:Oops.flg]  Run "C:\TOOLS\Oops.exe /l /s"

         Команда в вышеприведенном примере будет выполняться  только  в  том
     случае, если Sf-Mail запущен под OS/2 и только линиями 1, 3 и 5.


    x. Рабочий цикл Sf-Mail

         Как и всякая автономная программа,  Sf-Mail имеет замкнутый рабочий
     цикл, в который входят операции формирования очереди, ответы на входные
     звонки,  осуществление исходящих звонков,  прием и  передача  файлов  и
     почты,  обслуживание файловых запросов,  запуск внешних процессов и еще
     много функций, которые будут описаны далее в данной документации.


    x.y. Запуск, параметры командной строки

         Запуск Sf-Mail обычно производится из циклического пакетного файла.
     При   запуске   следует    передать    параметры,    указывающие    имя
     конфигурационного файла и номер линии.  В общем случае командная строка
     Sf-Mail имеет вид:

       Sf-Mail.exe /cCfgPathAndFilename /nLine /hHeartType

     где:

       CfgPathAndFilename  -- указывает   полный   путь    и    имя    файла
                              конфигурации;

       Line                -- номер  линии,  который  должен   быть   указан
                              десятичным числом из промежутка от 0 по 16.

       Heart               -- тип индикатора, находящегося в  правом  нижнем
                              углу экрана; допустимы значения:

                               0 - отключен (отсутствует);

                               1 - отображается в виде пульсирующего символа
                                   `*';

                               2 - отображается в виде пульсирующего сердца;

                               3 - отображается в виде  перемещающихся  друг
                                   относительно друга букв `S' и `F'.

                              ПРИМЕЧАНИЕ!  Типы  индикатора   2   и   3   НЕ
                                           РЕКОМЕНДУЕТСЯ  использовать   при
                                           работе    под     мультизадачными
                                           операционными системами.


    x.y. Коды завершения Sf-Mail (Errorlevels)

         При выходе Sf-Mail  всегда  устанавливает  код  завершения  (т.  н.
     errorlevel),   проанализировав  который  (обычно  в   пакетном   файле,
     запускающем Sf-Mail) можно судить о причине  завершения  Sf-Mail.  Коды
     завершения   Sf-Mail   делятся   на   две   категории:    ошибочные   и
     пользовательские.

                          Список errorlevel`ов
                          ────────────────────

     КОД: 0
     ═══
     ОПИСАНИЕ: Выход по команде оператора (Alt/Q)
     ──────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Нет
     ──────────────────────

     КОД: 20 - 100
     ═══
     ОПИСАНИЕ: Зарезервированы для пользователя
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Нет
     ──────────────────────

     КОД:
     ═══
     ОПИСАНИЕ:
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ:
     ──────────────────────

     КОД: 208, 209
     ═══
     ОПИСАНИЕ: Не найден оверлей
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Убедитесь, что Вы запустили Sf-Mail находясь  в
     ──────────────────────  его системном каталоге.
                             Проверьте наличие файла sf-mail.ovr в системном
                             каталоге Sf-Mail.

     КОД: 210
     ═══
     ОПИСАНИЕ: Проблемы с инициализацией фоссила
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Проверить наличие фоссила в памяти.
     ──────────────────────

     КОД: 211
     ═══
     ОПИСАНИЕ: Невозможно проинициализировать модем.
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Убедитесь в наличии модема  и  в  том,  что  он
     ──────────────────────  включен. Проверьте,  правильно  ли  Вы  указали
                             номер коммуникационного  порта  в  конфигурации
                             переменной ComPort секции Modem.

     КОД: 220
     ═══
     ОПИСАНИЕ: Не найден файл конфигурации
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Проверьте, правильно ли Вы указали в  командной
     ──────────────────────  строке путь и имя файла конфигурации Sf-Mail.

     КОД: 221
     ═══
     ОПИСАНИЕ: Невозможно открыть лог-файл
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Убедитесь  в  корректности  указанных  в  файле
     ──────────────────────  конфигурации переменной Log секции  Directories
                             пути и имени лог-файла.

     КОД: 222
     ═══
     ОПИСАНИЕ: Невозможно открыть один из нодлистов
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Перекомпиллируйте нодлисты  с  помощью  утилиты
     ──────────────────────  sf-nc и перезапустите Sf-Mail.


     КОД: 223
     ═══
     ОПИСАНИЕ: Один или несколько нодлистов не соответствуют индексу
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Перекомпиллируйте нодлисты  с  помощью  утилиты
     ──────────────────────  sf-nc и перезапустите Sf-Mail.


     КОД: 225
     ═══
     ОПИСАНИЕ: Ошибка загрузки файла поддержки языков
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Проверьте наличие в системном каталоге  Sf-Mail
     ──────────────────────  файла с именем sf-mail.lng.


     КОД: 230
     ═══
     ОПИСАНИЕ: Ошибка инициализации менеджера событий
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Проверьте    наличие    подключаемых    файлов:
     ──────────────────────  маршрутизации,   расписания   событий,    файла
                             управления процессами. А  так  же  убедитесь  в
                             корректности заданного Вами почтового  каталога
                             (netmail folder).

     КОД: 231
     ═══
     ОПИСАНИЕ: Ошибка инициализации модуля доступа к нодлисту
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Проверьте наличия индекса нодлиста  (adNdl.idx)
     ──────────────────────  и   файла   трансляции    телефонных    номеров
                             (adPhone.trx) в каталоге,  заданном  переменной
                             конфигурации Nodelist секции  Directories.  При
                             отсутствии  хотя  бы  одного  их  этих   файлов
                             перекомпиллируйте  нодлисты   утилитой   sf-nc.
                             Убедитесь  в  наличии   и   соответствии   всех
                             подключенных нодлистов.

     КОД: 240
     ═══
     ОПИСАНИЕ: Выход по команде встроенного Doorway без указания кода выхода
     ────────
     РЕКОМЕНДУЕМЫЕ ДЕЙСТВИЯ: Нет.
     ──────────────────────

         Если  Sf-Mail  завершился  с  каким-либо  другим   кодом,   то   мы
     рекомендуем Вам срочно связаться  с  авторами  и  предоставить  им  всю
     необходимую  информацию  о  возникшей  ситуации  в  целях  профилактики
     возможной ошибки.


    x. Обработка исходящих звонков

         Теперь рассмотрим принципы осуществления исходящих звонков. Как уже
     говорилось ранее,  звонить на тот или  иной  адрес  Sf-Mail  заставляет
     наличие активных элементов в очереди.


    x.y. Порядок построения исходящей почтовой сессии

         По истечении периода времени,  задаваемого переменной  конфигурации
     CallPeriod секции Miscellaneous,  Sf-Mail анализирует очередь и ищет  в
     ней следующий активный элемент.  Если таковой элемент  найден,  Sf-Mail
     извлекает информацию о нем: телефон, флаги, название станции и набирает
     его телефонный номер.


    x.y.z. Набор номера и ожидание соединения

         Однако,  может случиться так,  что  при  снятии  трубки  и  попытке
     набрать телефонный номер модем обнаружит отсутствие тонального сигнала.
     Это  может  случиться,   если  кто-то  разговаривает  по  параллельному
     телефону,  что является частой ситуацией на домашних почтовых узлах.  В
     таком случае самое разумное решение для мэйлера было бы положить трубку
     и `заморозить'  на  некоторое  время  исходящие  звонки.  И  это  можно
     осуществить! Для этой цели в файле конфигурации в  секции  Modem  нужно
     задать переменной NoDial_Wait требуемую задержку в секундах.
         Когда телефонный номер набран,  Sf-Mail переходит в стадию ожидания
     соединения (Wait carrier state).  Продолжительность этой  стадии  можно
     задать переменной конфигурации WaitCarrier_Out секции Modem -- для всех
     исходящих звонков и в листе подстановок командой Wait --  индивидуально
     для каждого адреса. Естественно,  если Ваш модем распознает сигнал BUSY
     раньше,  чем истечет  заданное  время,  то  Sf-Mail  выйдет  из  стадии
     ожидания соединения раньше.  В противном  случае  Sf-Mail  будет  ждать
     соединения столько, сколько Вы ему предписали.
         Допустим,  Sf-Mail набрал  требуемый  телефонный  номер,  удаленная
     система нам ответила  и  модемы  успешно  соединились.  Что  происходит
     дальше?


    x.y.z Особенности прозвонки по Named Poll

         При звонке по Named  Poll  (tm)  после  появления  несущей  Sf-Mail
     запустит процесс,  описанный в  соответствующем  файле-семафоре.  После
     возврата в из запущенной задачи семафор не удаляется -- об этом  должен
     позаботиться сам пользователь,  например,  в bat-файле,  запускаемом по
     Named Poll описать команду удаления семафора.


    x.y.z. Обработка EMSI

         Прежде  всего,   почтовые   программы   с   обоих   сторон   должны
     представиться друг другу.  Это осуществляет посредством протокола  EMSI
     -- Electronic Mail System Identification.  В ходе обмена  EMSI-пакетами
     мэйлеры сообщают  друг  другу  информацию  о  своих  адресах,  названия
     станций,   имена  системных  операторов  и   некоторую   дополнительную
     информацию.
         Ключевой информацией в EMSI-пакете является список адресов  системы
     и пароль на сессию.  При расшифровке  EMSI-пакета  Sf-Mail  анализирует
     адреса,  отсеивая те,  пароль к  которым  не  совпадает  с  заданным  в
     локальном файле паролей (подключается переменной конфигурации Passwords
     секции Files) и если после этой операции остался хоть  один  корректный
     адрес,  то формируется список писем и файлов для отправки.  В противном
     случае  сессия  будет  оборвана,   а  в  лог  и   на   экран   выведена
     соответствующая надпись.


    x.y.z. Протоколы приема/передачи файлов

         После того, как системы распознали друг друга,  запускается один из
     протоколов приема/передачи  файлов.  Sf-Mail  имеет  два  протокола  --
     однонаправленный  Z-Modem  и  двунаправленный   Hydra.   Право   выбора
     протокола принадлежит отвечающей стороне. Выбор протокола происходит на
     стадии EMSI и к завершению обмена рукопожатием обе  стороны  уже  точно
     знают, по какому протоколу будет производиться обмен файлами.
         Если во время EMSI выясняется,  что стороны  не  имеют  совместимых
     протоколов, то происходит принудительный разрыв соединения.


    x.y.z. Передача файлов

         В случае с протоколом Z-Modem первой начинает  передачу  вызывающая
     сторона.  При  обмене  по  протоколу  Hydra  прием  и  передача  файлов
     производится одновременно в обе стороны.
         Файлы  посылаются   по   списку,   сформированному   после   приема
     EMSI-пакета.  Порядок передачи файлов строго регламентирован и содержит
     три стадии:

       1) Персональная почта (NetMail);
       2) Эхопочта (EchoMail);
          Пакеты эхопочты передаются  в  отсортированном  по  дате  создания
          порядке, т.е. сначала будут переданы более старые пакеты, а  затем
          более новые.
       3) Все остальные файлы.

         Причина отправки персональной почты первой в  том,  что  она  имеет
     более высокий приоритет, чем все прочие типы файлов.

         Передача заканчивается,  когда  больше  нечего  передавать.  И  при
     обмене по протоколу Z-Modem вызывающий Sf-Mail должен перейти  в  режим
     приема.  Протокол Hydra работает несколько иначе:  он  запускается  два
     раза за сессию,  причем даже в том случае,  если слать ни в одну  ни  в
     другую сторону нечего.  Перед сменой направления на Z-Modem  или  перед
     началом второй стадии на Hydra Sf-Mail проверит файловые ящики, т.к. за
     время сессии в них могут появиться новые файлы.  Если обнаружены  новые
     файлы,  то они будут немедленно отправлены и только после этого Sf-Mail
     сменит направление передачи.


    x.y.z. Прием файлов

         Прием файлов осуществляется в каталог,  заданный переменной Inbound
     -- при  незапароленной  сессии,  или  в  каталог,  заданный  переменной
     Secured_Inbound -- при запароленной сессии.
         Если при принятии файла  Sf-Mail  обнаружил,  что  такой  файл  уже
     имеется  в  принимающем  каталоге,   то  он  сравнит  даты  и   размеры
     принимаемого и имеющегося файла и на основании сравнения выполнит  одно
     из действий:

         1) Имеющийся файл более старый по дате,  чем принимаемый -- Sf-Mail
     переименует имеющийся файл и будет принимать новый на его место.
         2) Имеющийся файл имеет такую же дату, что и принимаемый -- Sf-Mail
     сообщит удаленной системе об этом и пропустит этот файл.


    x.y.z. Пороговое значение CPS

         Иногда из-за плохого качества телефонной  линии  скорость  передачи
     файлов снижается весьма значительно. А бывает и так,  что при повторном
     звонке качество улучшается.  Поэтому в Sf-Mail  введены  два  пороговых
     значения скорости передачи,  которые позволяют  оборвать  сессию,  если
     эффективность упала ниже допустимого предела. Этим управляют переменные
     CPS_Threshold_1 и CPS_Threshold_5 секции Miscellaneous.  Первая из  них
     задает минимальный cps после одной минуты передачи,  а вторая --  после
     пяти минут.  И если текущий cps ниже указанных значений,  то происходит
     разрыв соединения.


    x.y.z. Ограничение исходящей сессии по времени

         Иногда  нужно  иметь  возможность  ограничивать   продолжительность
     исходящих  почтовых  сессий  по  времени.   Этим  управляет  переменная
     SessionLimit_Out секции Miscellaneous.  Ее значение позволяет  оборвать
     сессию,  если  она  длится  более  указанного  количества  минут.   Эта
     переменная задает  лимит  по  времени  на  исходящую  сессию  для  всех
     адресов.  Но можно указать лимиты и для каждого адреса в частности -- с
     помощью команды Limit в листе постановок. (см. X.Y.Z.)


    x. Процессы, выполняемые после почтовой сессии

         Во время сессии  Sf-Mail  анализирует  типы  принимаемых  файлов  и
     выставляет соответствующие внутренние флаги.  После  того,  как  сессия
     завершилась, Sf-Mail запускает соответствующие флагам процессы, которые
     описываются в Файле Управления Процессами (см.  X.Y.Z.).  Но перед тем,
     как приступить к запуску соответствующих процессов,  Sf-Mail  распакует
     все принятые netmail-пакеты (файлы с расширением pkt), если конечно это
     не отключено переменной конфигурации AMA_Support секции System.
         Кроме того,  условие ArcMail сработает только в  том  случае,  если
     сумма объемов принятого за эту и предшествующие сессии превысило число,
     заданное в переменной ArcMail_Threshold секции Miscellaneous.  В случае
     превышения заданного объема принятой  эхо-почты  внутренняя  переменная
     Sf-Mail,  служащая сумматором,  обнуляется и в  следующий  раз  условие
     ArcMail выполниться только после повторного накопления соответствующего
     объема эхо-почты.
         Отметим,  что  процессы  группы  AfterSession,   заданные  в  Файле
     Управления Процессами выполняются только  один  раз  для  каждого  типа
     принятых файлов.


    x. Обработка входящих звонков

         В обязанности Sf-Mail так же  входит  функция  ответа  на  входящие
     звонки  с  последующим  проведением  почтовой   сессии   или   запуском
     какой-либо внешней программы, как то BBS, факс-менеджер, автоответчик и
     т.п.
         Можно заставить Sf-Mail отвечать на звонки  только  в  определенное
     время.  Список интервалов времени,  определяющий,  когда Sf-Mail  может
     отвечать  на  входящие  звонки  задается  переменной   OH_Time   секции
     General_Info  и  может  содержать  до  семи  промежутков,   разделенных
     запятыми.
         Sf-Mail может поднимать трубку не при первом  звонке.  Это  функция
     задается переменной конфигурации Answer_Ring секции Modem и может  быть
     актуальна для станций,  находящихся дома или там,  где одна  телефонная
     линия является и голосовой и модемной.
         Определение  наличия  входящего  звонка  может   происходит   двумя
     методами: по пришедшей от модема строке `RING' или по сигналу RI. Метод
     определения задается переменной Hardware_Ring секции Modem.


    x.y. Поднятие трубки и распознавание звонящего

         Поднятие трубки производится посылкой  на  модем  строки,  заданной
     переменной Modem_Answer секции Modem.  После этого Sf-Mail переходит  в
     стадию  ожидания  соединения,  продолжительность  которой  регулируется
     переменной WaitCarrier_In секции Modem.
         После  появления  несущей  Sf-Mail  пытается  определить,  кто  ему
     звонит, и в соответствии с результатом выполнить требуемую операцию.


    x.y.z. Запуск BBS

         Если звонящий нажал дважды ESC,  то  Sf-Mail  считает,  что  звонит
     пользователь BBS и в случае,  если BBS разрешена,  запускает программу,
     указанную в переменной Process_BBS секции BBS.
         Можно  разрешить  вход  на  BBS  только  в  определенные  интервалы
     времени,   которые  задаются  переменной   BBS_Time   секции   BBS.   В
     соответствии со значением этой переменной,  а так же с тем,  указана ли
     вообще командная строка для запуска BBS,  Sf-Mail пересылает  звонящему
     одну из строк, задаваемых переменными User_Answer и NoBBS_Answer секции
     BBS.


    x.y.z. Запуск внешнего мэйлера

         Под внешним мэйлером в данном случае  понимается  любая  программа,
     запускаемая Sf-Mail  при  получении  определенной  строки  от  звонящей
     стороны.  Соответствие строк  и  программ,  запускаемых  по  их  приему
     описывается в файле управления процессами.
         После  запуска  внешнего  мэйлера  Sf-Mail  не  пытается   провести
     почтовую сессию, а просто возвращается в основной режим.


    x.y.z. Активизация встроенного DoorWay

         Уникальная  возможность  Sf-Mail   --   это   наличие   встроенного
     командного интерпретатора, работающего в online-режиме.  Т.о.  позвонив
     обычным терминалом на Sf-Mail и введя после соединения пароль, заданный
     переменной Doorway_Password секции Miscellaneous,  Вы можете работать с
     файловой  системой  на  удаленной  машине   --   копировать,   удалять,
     переименовывать,   посылать,   принимать  файлы,   управлять  очередью,
     корректировать время и дату, и т.д.
         Более подробно об использовании встроенного DoorWay и его  командах
     будет рассказано позже (см. X.Y.Z.).


    x.y. Входящая почтовая сессия

         Основная работа мэйлера -- принимать и передавать почту и файлы.  И
     эта операция осуществима в рамках почтовой сессии.


    x.y.z. Обработка EMSI

         После появления несущей  Sf-Mail  пытается  установить  почтовую  и
     ожидает прихода  от  удаленной  стороны  EMSI-пакета.  После  получения
     EMSI-пакета Sf-Mail анализирует его,  формирует свой пакет и отправляет
     удаленной системе.
         Когда системы  распознали  друг  друга,  запускается  выбранный  на
     стадии EMSI протокол приема/передачи и далее сессия  проходит  так  же,
     как было описано в разделе XXXX.


    x.y.z. Ограничение входящей сессии по времени

         Время  входящей  сессии  можно  ограничить,   указав  в  переменной
     SessionLimit_In соответствующее значение.  Эта переменная задает  лимит
     входящей сессии по времени для всех  адресов.  Отдельно  для  некоторых
     адресов можно задать лимит в  листе  подстановок  командой  Limit  (см.
     X.Y.Z.).


    x. Обслуживание файловых запросов

         Sf-Mail  обрабатывает   файловые   запросы   (File   requests)   по
     спецификации WaZoo File Requests, описанной в FTS-0006.


    x.y. Конфигурирование встроенного FReq Manager

         Переменные конфигурации секции  FReq_Support  позволяют  достаточно
     гибко  настроить  внутренний  менеджер   файловых   запросов   Sf-Mail.
     Допустимо  задать  ограничения  как  по  времени,   так  и  по   объему
     запрашиваемых файлов.  Так  же  можно  установить  запрет  на  файловые
     запросы для группы адресов,  что позволяет ограничить доступ к файловой
     базе, разрешив его только отдельной категории узлов,  например,  Listed
     -- разрешить файловые  запросы  только  для  известных  нашей  системе;
     Protected -- только для тех, сессия с которыми запаролена.


    x.y. Подключение внешнего Request Processor

         Если  Вас  не  устраивает  внутренний  менеджер  файловых  запросов
     Sf-Mail,  то Вы можете подключить внешний,  которых  на  данный  момент
     времени имеется достаточно широкий выбор.
         Внешний  реквест-процессор  подключается  переменной   конфигурации
     FR_Xternal секции FReq_Support.  Техника стыковки внешнего  обработчика
     файловых запросов и Sf-Mail достаточно проста: после получения во время
     сессии файла-запроса (*.req) Sf-Mail запустит  программу  по  командной
     строке, заданной переменной FR_Xternal. В процессе своей работы внешний
     Request Processor создает т.н. файл ответа, имя которого нужно задать в
     переменной FR_Response.  Этот файл должен иметь текстовый  формат  и  в
     каждой строке содержать путь и имя файла для отправки. В первой позиции
     каждой строки может стоять  служебный  символ,  определяющий  действие,
     которое необходимо произвести над файлом после его отправки.
         Ниже приведен список служебных символов, воспринимаемых Sf-Mail:

        ТАБЛИЦА 5. Модификаторы файла ответа ERP.
      ┌──────┬───────────────────────────────────────────────────────┐
      │Символ│                Требуемое действие                     │
      ├──────┼───────────────────────────────────────────────────────┤
      │  ?   │ Если передача файла прошла успешно, удалить файл      │
      │      │ в противном случае файл не удалять                    │
      ├──────┼───────────────────────────────────────────────────────┤
      │  +   │ Не удалять файл                                       │
      ├──────┼───────────────────────────────────────────────────────┤
      │  -   │ Удалить файл независимо от успешности его передачи    │
      └──────┴───────────────────────────────────────────────────────┘


    x. События (Events)

         Обработка событий является одной  из  основных  функций  автономных
     систем.  И Sf-Mail не является исключением.  Он умеет обрабатывать  как
     внутренние события -- создание  элементов  очереди  для  опроса  узлов,
     переустановка значений переменных конфигурации,  и т.д.,  так и внешние
     -- запуск программ и bat-файлов.


    x.y. Обработчик событий (Event Manager)

         Обработка событий  в  Sf-Mail  производится  внутренним  менеджером
     событий  (Internal  Event  Manager),   который  выполняет  предписанные
     пользователем действия в заданные интервалы времени.


    x.y. Описание событий в Events.ctl

         Расписание  событий  задается  в  файле,   подключаемом  переменной
     EventsList секции Files.  Файл описания событий имеет текстовый формат.
     В каждой строке его описывается  одно  событие.  В  общем  виде  строка
     описания события имеет вид:

         [^][%]<EventType> [Interval] <Parameters> [TimePeriod]

     Где:

      ^  -- Модификатор, указывающий на то, что это событие нужно  выполнять
            при каждом запуске Sf-Mail;
      %  -- Модификатор периодического события;

      EventType  -- Тип события;
      Interval   -- Период для периодических событий;
      Parameters -- Специфические параметры для конкретного типа событий;
      TimePeriod -- Время действия события.

         Ниже приведен полный список типов событий с примерами.

     Exec            <"Command"> <TimePeriod>
     ────┘
     Выполнить команду Command во время TimePeriod.

     ПРИМЕР:
      ;
      ; При каждом запуске в интервале 18:30-06:00 будем
      ; генерировать пустой полл для прозвонки на /142
      ;
       ^Poll  2:5030/142         18:30-06:00
      ;
      ; Пусть на исходе каждого дня запускается генератор статистики:
      ;
       Exec  "{L}All_Stat.btm"   23:31-23:59
      ;        ^-- модификатор, указывающий на необходимость
      ;            записи кэш-буфера лог-файла.
      ;
      ; ..а по утрам мы будем запускать ежедневные процедуры:
      ;
       Exec  "{L}Daily.btm"      08:33-09:01
      ;
      ; Каждые два часа будем запускать тоссинг:
      ;
       %Exec 02:00  "C:\BBS\FE\Toss.btm"  00:00-23:59
      ;

     Exit            <ErrorLevel> <TimePeriod>
     ────┘
     Выход с уровнем <ErrorLevel> во время <TimePeriod>

     ПРИМЕР:
      ;
      ; Перед моим приходом на работу Sf-Mail обязан ;-) выйти
      ; с 37-ым errorlevel`ом и bat-файл загрузит DosNavigator:
      ;
       Exit  37  09:02-09:22
      ;
      rem ======>8 Sf-Mail.bat 8<=================================
      :_Sf_Mail_
      cd \BBS\SF-MAIL
      llclcom /P:3 /I:5 /LK:57600:8N1 /RSZ:8192 /TSZ:2048 /FS
      Sf-Mail
      llclcom /U
      if errorlevel 37 goto _Run_Dn_
        . . . . . .
      :_Run_Dn_
      cd \DN
      Dn.bat
      goto _Sf_Mail_
      rem ======>8 Sf-Mail.bat 8<=================================

     RePack          <AddressList> <TimePeriod>
     ──────┘
     Перепаковать почту для адресов, подпадающих под маски AddressList
     во время TimePeriod.
     Эта команда заставляет Sf-Mail удалить элементы очереди для адресов,
     подпадающих под заданную маску и создать из заново.
     ПРИМЕЧАНИЕ: Рекомендуется давать эту команду с аргументом 'All'
                 несколько раз в сутки, для профилактики застойных
                 явлений в netmail`е.

     ПРИМЕР:
      ;
      ; Перепаковка всей почты перед ZMH (все узлы в этот час должны
      ; принимать netmail => можно им звонить, а не посылать по роутингу):
      ;
       Pack   2:5030/*.0   05:20-05:40
      ;
      ; После ZMH действуют обычные правила маршрутизации:
      ;
       Pack   2:5030/*.0   06:32-07:00

     ПРИМЕР:
      ;
      ; Перепаковка будет производиться каждые два с половиной часа:
      ;
       %Repack  02:31  *:*/*.*  00:00-23:59
      ;

     Pack  - то же, что и RePack (см. выше)
     ────┘

     Poll            <AddressList> <TimePeriod>
     ────┘
     Создать  пустое  письмо  для  активизации  опроса   узлов   из   списка
     AddressList. МАСКИ И ГРУППЫ АДРЕСОВ ЗАПРЕЩЕНЫ!

     ПРИМЕЧАНИЕ: Событие Poll только создает  пустое  письмо  (что  является
                 поводом для звонка), но Sf-Mail не будет звонить,  если  он
                 не уверен, что заданный узел поддерживает входящие звонки в
                 это время. Для указания времени работы узла  (если  оно  не
                 задано я оно в  нодлисте  с  помощью  флагов  Txy  или  CM)
                 используйте лист подстановок -- Subst.lst

     ПРИМЕР:
      ;
      ; При каждом запуске в субботу и воскресенье будем
      ; создавать пустой полл для прозвонки на /143
      ;
       ^Poll  2:5030/143.0  6.00:00-0.23:01
      ;
      ; Каждые четыре часа будем активизировать прозвонку
      ; на 2:5030/142
      ;
       %Poll 04:00   2:5030/142   18:00-07:31
      ;

     Drop            <AddressList> <TimePeriod>
     ────┘
     Удалить служебные письма от Sf-Mail для адресов  AddressList  во  время
     <TimePeriod> и перепаковать для них почту.
     Служебными письмами в данном случае  считаются  письма,  сформированные
     самим Sf-Mail`ом при выполнении события Poll и оператором с  клавиатуры
     по клавишам Alt/P (poll), Alt/R (request files),  Alt/S  (send  files).
     После  уничтожения  служебных  писем  почта  для  этих  адресов   будет
     перепакована, а счетчик попыток прозвонки -- обнулен.

     ПРИМЕЧАНИЕ: Если    включена    поддержка    bynk-style     (переменная
                 BinkOutbound), то по команде Drop Sf-Mail удалит не  только
                 пустые служебные письма, но и пустые файлы  *.?lo  и  *.?ut
                 для заданных адресов.

     ПРИМЕР:
      ;
      ; Создадим пустое письмо для опроса /74-го узла:
      ;
       Poll  2:5030/74  02:00-02:31
      ;
      ; Время прозвонки истекло. Уничтожим созданное по команде poll
      ; письмо:
      ;
       Drop  2:5030/74  04:01-04:33
      ;

     Set             <"CfgWord NewParam"> <TimePeriod>
     ───┘
     Изменить значение системного параметра для CfgWord на NewParam.

     Событие Set позволяет установить для CfgWord новое значение NewParam во
     время, определенное в TimePeriod.

        CfgWord     - Имя одной из переменных конфигурации;
        NewParam    - Новое значение;
        TimePeriod  - Время отработки события.

     ПРИМЕЧАНИЕ:    Событие Set относится к классу StartUp, т.е. при запуске
                  Sf-Mail все события Set  будут  отработаны,  если  текущее
                  время входит в интервал действия события.
                    Это свойство событий класса StartUp  позволяет  избежать
                  восстановления старых значений переменных конфигурации при
                  случайных  перезапусках  Sf-Mail  (например,  при   потере
                  питания).

         Следует помнить,  что изменить  можно  не  все  настройки  Sf-Mail.
     Например,  нельзя изменить значение  Address,  переменных,  описывающих
     пути и имена дополнительных файлов конфигурации (Route.ctl,  etc).  При
     попытке  изменить  значение  запрещенной  переменной   Sf-Mail   выдаст
     предупреждающее сообщение и проигнорирует это событие.

     ПРИМЕР:
      ;
      ;--- Секция описания событий ---
      ;
      ; Отключим все звуки на ночь..
       Set  "SoundControl    0"  23:59-08:00
      ;
      ; Установим более длительный интервал между выходящими звонками..
       Set  "CallPeriod     72"  01:00-07:30
      ;
      ; Днем звуки разрешим..
       Set  "SoundControl FFFF"  08:01-23:58
      ;
      ; Сократим интервал между выходящими звонками до разумного минимума..
       Set  "CallPeriod      7"  07:31-00:59
      ;
      ;-------------------------------

     CutLog          <KeepDays> <TimePeriod>
     ──────┘
     Запустить внутренний урезатель лог-файла в во время <TimePeriod>

     По наступлению события CutLog Sf-Mail урежет свой лог-файл  так,  чтобы
     он содержал информацию только за последние <KeepDays> дней.

     НАПРИМЕР:

      ;-------------------------------------------------------
      ; Каждую субботу утром будем усекать лог-файл так, чтобы
      ; он содержал только записи за последние пять дней.
      ;
       CutLog  5  6.08:01-6.09:00
      ;-------------------------------------------------------

     ВАЖНОЕ ЗАМЕЧАНИЕ!

         В описании событий параметр  TimePeriod  означает  только  то,  что
     событие будет выполнено в этот период времени сразу, как только Sf-Mail
     освободится (т.е.  как только он будет  находиться  в  режиме  ожидания
     входящего звонка или события).  Т.о.  если вы описываете событие Set  и
     задаете интервал его отработки, например,  с 18:00 до 22:00,  то это не
     означает,  что после 22:00 Sf-Mail восстановит старое значение из файла
     конфигурации. Т.е.  для отмены этого события Set Вам следует задать еще
     одно -- начинающееся в 22:00.  Аналогичная ситуация и с событием  Poll,
     которое генерирует пустой  элемент  очереди  для  опроса  узла,  но  по
     истечении указанного TimePeriod  Sf-Mail  самостоятельно  не  уничтожит
     этот элемент очереди -- это должны сделать Вы,  задав  событие  Drop  с
     соответствующими параметрами.


    x. Дополнительные возможности

         Sf-Mail является в своем роде интегрированной средой,  т.е.  наряду
     со   стандартными   функциями   мэйлера,   он   может   выполнять   ряд
     дополнительных,   которые  существенно  облегчают  управление  почтовой
     станцией.


    x.y. Встроенный Message Tracker

         С  помощью  встроенного  Message  Tracker  Sf-Mail  может  изменять
     некоторые параметры проходящих через  узел  писем.  Команды  управления
     Message Tracker задаются в файле конфигурации в секции Miscellaneous  и
     имеют формат:

      Msg_Track '<toname>,<toaddr>,<attrs>,<chgname>,<chgaddr>,<chgattrs>'

     где:

     <toname>   - Задает имя или его часть, которое будет  искаться  в  поле
                  ToName письма;
     <toaddr>   - Адрес, который будет искаться в поле DestAddr;
     <attrs>    - Атрибуты, которые будут искаться в поле Attributes;
     <chgname>  - На что будет изменено имя в поле ToName;
     <chgaddr>  - На что будет изменен адрес в поле DestAddr;
     <chgattrs> - Какие атрибуты будут изменены.

         Т.е.  первые  три  параметра  задают  условия,   по  которым  будут
     определяться письма,  подлежащие изменению,  а последние три  параметра
     задают изменения, которые необходимо произвести в таких письмах.
         Разрешено использование макро-символов `*',  которые в первых  трех
     параметрах интерпретируются как `ЛЮБОЕ ЗНАЧЕНИЕ', а в последних трех --
     как `НЕ МЕНЯТЬ'.
         Параметру <toname> могут предшествовать символы `!' и/или `~'. Если
     указан символ `~',  то параметр  <toname>  представляет  собой  не  имя
     целиком, а подстроку.

     НАПРИМЕР

      имеем письмо:

        FROM: Uncle Bents         1:9990/123
          TO: Anton V. Deinow     2:5030/143.1

      установки Msg_Track:

        Msg_Track  '~Deinow,2:5030/143.1,*, Anton the Deinow,*,*'

         Такое письмо будет соответствовать приведенной  команде  Msg_Track,
     т.к.  поле ToName его содержит подстроку `Deinow'  и  адрес  назначения
     DestAddress  совпадает  с  заданным  <toaddr>,  реакцией  робота  будет
     изменение поля ToName на `Anton  the  Deinow',  а  адрес  назначения  и
     атрибуты не будут изменены,  т.к.  <chgaddr> задано  символом  `*'  (не
     изменять).

         Символ `!' означает ОТРИЦАНИЕ.  Если он указан,  то  должен  стоять
     первым в поле!

     НАПРИМЕР

      письмо:

        TO: Anton Deinow  2:5030/143

      установка Msg_Track:

        Msg_Track  !~the Deinow,2:5030/143,*, Anton the Deinow,*,*

         Реакцией Msg-Track`а на данное письмо будет изменение  поля  ToName
     на `Anton the Deinow', т.к.  оно HE СОДЕРЖИТ (`!') ПОДСТРОКУ (`~') `the
     Deinow',   а  адрес  назначения  DestAddress  совпадает  с  заданным  в
     <toaddr>.  Атрибуты и адрес назначения не изменятся,  т.к.  <chgaddr> и
     <chgattrs> заданы символом `*'.

         Атрибуты  задаются  в  виде  списка  идентификаторов,   разделенных
     пробелом.  Перед каждым атрибутом должен стоять символ `+'  или  символ
     `-'.
         Для поля <attrs> символ плюс (+) означает, что данная команда будет
     влиять только на те письма,  которые имеют  указанный  атрибут.  Символ
     минус (-) означает, что этот атрибут должен отсутствовать.

     НАПРИМЕР

        письмо #1 имеет атрибуты: Pvt,Loc
        письмо #2 имеет атрибуты: Pvt,F/A,Loc
        письмо #3 имеет атрибуты: Pvt,FReq,Loc

      команда

        Msg_Track  *,*,+FReq -F/A, *,*,+Hold

     будет выполнена только для письма #3, т.к. лишь оно подходит по условию
     (наличие атрибута FReq и отсутствие F/A).

         Атрибуты в параметре <chgattrs> также должны предваряться символами
     плюс или минус, но значение их другое:

      - Те атрибуты, которые  указаны  со  знаком  `+'  будут  принудительно
        установлены на письме;
      - Атрибуты со знаком `-' будут принудительно сняты.

                    Ниже приведен список допустимых атрибутов:

      Pvt   - private
      Crsh  - crash
      Rcvd  - received (read)
      Sent  - sent
      F/A   - file attached
      Fwd   - forwarded (intransit)
      Orph  - orphaned
      K/S   - kill/sent
      Loc   - local
      Hold  - hold
      FReq  - file request

         Максимальное число команд Msg_Track -- 16.


    x.y. Именные почтовые ящики (Mail Boxes)

         Именные  (персональные)  почтовые  ящики  (Mail  Boxes)   выполняют
     двоякую функцию:  они позволяют освободить основной почтовый каталог от
     писем на заданные имена,  и в то  же  время,  при  чтении  персональной
     почты,  заботливо перенесенной Sf-Mail`ом в почтовый ящик,  на глаза не
     будут попадаться транзитные письма и аттачи.

         Для каждого ящика должны быть определены два обязательных параметра
     -- имя владельца и каталог,  в который будут переносится  пришедшие  на
     это имя письма.  Также  существует  возможность  задать  режим  доступа
     Sf-Mail к ящику:

      RW  --  Read/Write: письма будут переноситься как из NetMail`а в ящик,
              так и из ящика в NetMail;
      WO  --  WriteOnly:  письма  будут  переносится  только  в  направлении
              NetMail -> MailBox;
      RO  --  ReadOnly:  письма  будут  переноситься  только  в  направлении
              MailBox -> NetMail.

         По умолчанию выставляется атрибут RW.

         Важно помнить,  что менеджер  персональных  почтовых  ящиков  может
     переносить в ящик только те письма,  в поле DestAddress которых  указан
     один из Ваших адресов.

     ПРИМЕР:

      MailBox    'Joe Lamer'  L:\MSGBASE\JOE_MAIL    RW

         Эта команда описывает персональный почтовый ящик для пользователя с
     именем Joe Lamer и атрибутами доступа `чтение/запись'. Т.е. все письма,
     содержащие в поле ToName имя Joe Lamer будут переноситься в каталог  L:
     \MSGBASE\JOE_MAIL. Кроме того, письма с атрибутом Local,  найденные в в
     этом каталоге, Sf-Mail перенесет в основной почтовый каталог.


     НАПРИМЕР:

      MailBox    'Anton the Deinow' J:\MSG\PVTMAIL   RW
      MailBox    'Anton Deinow'     J:\MSG\PVTMAIL   RO

         Вышеприведенный пример освобождает Sf-Mail от сканирования одного и
     того же каталога  два  раза  подряд  в  поисках  писем,  которые  нужно
     переместить в NetMail.

         Работа менеджера персональных почтовых ящиков зависит  от  значения
     переменной AMA_Support секции System.  В общем случае Sf-Mail действует
     так: при распаковке принятых почтовых пакетов извлеченные из них письма
     сначала передаются на обработку менеджеру персональных почтовых ящиков,
     и если ящик с таким именем неопределен или письмо не на наш  адрес,  то
     оно укладывается в основной почтовый каталог. При установке AMA_Support
     в Pack распаковка пакетов не производится Sf-Mail`ом,  и как следствие,
     вышеописанная стадия отсутствует.
         Каждый  Rescan_Period  Sf-Mail  просматривает  не  только  основной
     почтовый каталог,  но и все  заданные  персональные  почтовые  ящики  с
     атрибутами доступа R/W и  R/O.  При  этом  письма  основного  почтового
     каталога передаются менеджеру персональных ящиков,  который при наличии
     соответствующего ящика положит письмо в заданный каталог.  Кроме  того,
     просматривая почтовые ящики, Sf-Mail переносит письма с атрибутом Local
     из них в основной почтовый каталог.  При установке AMA_Support в UnPack
     менеджер почтовых  ящиков  не  будет  переносить  письма  из  ящиков  в
     основной почтовый каталог и обратно на стадии Rescan_Period.


     ПРИМЕЧАНИЕ: Если Sf-Mail находит в почтовом ящике письмо  без  атрибута
                 K/S (Kill after sent), то он его не  переносит  в  основной
                 почтовый  каталог,  а  копирует.   Причем,   на   оригинал,
                 находящемся в  ящике,  устанавливается  атрибут  Sent,  что
                 предотвращает последующие попытки переноса этого  письма  в
                 основной  почтовый  каталог.  Причем,  в  поле  TimeArrived
                 письма-оригинала ставится время копирования.


    x.y. Встроенный DoorWay
    x.y. Встроенный FAX-Manager
    x.y. Язык скриптов


    x. Использованные инструменты и библиотеки

         При разработке программ пакета Sf-Mail были использованы:

     a) Turbo/Borland Pascal version 7.0;
     b) TASM 4.0
     c) TurboDebugger
     d) Доработанные библиотеки Turbo Profession;
     e) Dos Navigator;
     f) Zortech C;
     g) Watcom C/C++ 10.0-10.6;
     h) Watcom Debugger
     i) MultiEdit 7.0


    x. Использованные стандарты и документы

     FTS-0001         A basic FidoNet(r) technical standard, R. Bush

     FTS-0005         The distribution nodelist,  B. Baker, R. Moore

     FTS-0006         YOOHOO and YOOHOO/2U2, V. Perriello

     FTS-0009         Message identification and reply linkage, j nutt

     FSC-0009         Nodelist Flag Draft Document Gwinn/Dodell

     FSC-0011         Experiences/corrections to FSC-0001, B. Hartman

     FSC-0015         FOSSIL 5.0 Documentation, R. Moore

     FSC-0020         Alternate Nodelist Flag Proposal M. Presnell

     FSC-0025         AVATAR Video Spec, G. Stanislav

     FSC-0037         AVATAR 0+ Video Spec, G. Stanislav

     FSC-0043         Some hints on recognizing control lines in FidoNet(r)
                      message text, R. Bush

     FSC-0053         Specifications for the ^aFLAGS field, J. Homrighausen

     FSC-0056         EMSI/IEMSI Protocol Definition, J. Homrighausen

     FSC-0072         The HYDRA file transfer protocol, J. Homrighausen,
                      A. Lentz

     RFC1321          The MD5 Message Digest Algorithm

     ANSI X3.92-1981  Data Encryption Standard (DES)

     Interrupt List by Ralf Brown


    x. Благодарности

         Мы прошли огромный путь от объединения участников SantaFox Team  до
     выхода данной версии продукта SantaFox Mail  system.  Столь  глобальный
     проект,  как Sf-Mail  был  бы  невозможен  без  сочувствия  и  участия,
     конструктивной критики и классных идей  наших  бета-тестеров  и  просто
     людей, решивших попробовать Sf-Mail да так и не захотевших расстаться с
     ним.
         Так же мы  хотим  выразить  благодарность  всем  тем,  кто  пытался
     поддержать  Sf-Mail,  написав  дополнительные  утилиты  --  анализаторы
     логов, вьюверы очереди, и прочее.


    x. Торговые марки

                      Registered & unregistered trademarks

     ┌─────────────────────────────────────────────────────────────────────┐
     │ Trademark                           Owner                           │
     ├─────────────────────────────────────────────────────────────────────┤
       Sf-Mail                 SantaFox Team
       LLCLCOM                 SantaFox Team
       LLCL2I14                SantaFox Team
       Sf-Mail Mixed Mode      SantaFox Team
       Named Poll              SantaFox Team
       T-Mail                  Andy Elkin
       Fido, FidoNet           Tom Jennings and Fido Software
       IBM                     International Business Machines Corporation
       MS-Dos                  Microsoft Corporation
       MS-Windows              Microsoft Corporation
       Windows'95              Microsoft Corporation
       Novell DOS              Novell, Inc.
       PC-Dos                  International Business Machines Corporation
       OS/2                    International Business Machines Corporation
       DesqView                Quarterdeck, Inc.
       TSX-32 Lite OS          S&H Technology
       IPX Relinquish          Novell, Inc.
       RTS-386                 HT-Systems
       DoubleDos               ???
       Turbo/Borland Pascal    Borland International, Inc.
       TASM                    Borland International, Inc.
       Zortech C++             Symantec Corporation
       Watcom C                Watcom International Corp.
       Remote Access           Continental Software
       Maximus                 Scott J. Dudley
       FrontDoor               Joachim Homrighausen
       BinkleyTerm             Bit Bucket Software Co.
       Z-Modem                 ???
       Hydra                   Joaquim H. Homrighausen &
                               Lentz Software Develompment
       FastEcho                Software Technik Burchhardt
       AllFix                  Harald Harms
       BNU                     David Nugent & Unique Computing Ptd, Ltd
       X00, SIO                Raymond L. Gwinn
       VFOSSIL                 Paul Kingsep
       WinFossil               ???
       Hayes                   Hayes Microcomputer Products
       ZyXEL                   ZyXEL Communication Corp.
       USR Courier, HST        US Robotics Inc.
       Turbo Professional      TurboPower Software
       Dos Navigator           RIT Research Labs
       MultiEdit               American Cybernetics, Inc.
     └─────────────────────────────────────────────────────────────────────┘

    x. Epilogue
